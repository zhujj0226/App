F.module("mantpl:nav/mine_view",function(r,q,o){var n=$("#s_xmancard_mine .s-block-nav");var s='<span class="sp_sg_name">{{=it[4]}}</span><span class="sp_sg_url">{{=it[1]}}</span>';var l=r("superui:component/tips");var t=r("superui:util/dot");var m=r("superui:util/smDot");var p='<div class="dir-item dir-blank s-opacity-blank3" data-dir="#{dirId}" style="position:absolute;"><div class="dir-border s-opacity-blank3"></div><div class="white-border"></div><div class="dir-name s-opacity-blank3"><span class="name-text">#{dirName}</span><input type="text" value="#{dirName}" class="edting-dir-name" maxlength="19"/></div><div class="dir-content s-opacity-blank3"></div><div class="del-dir"><span class="del-dir-icon"></span><span class="del-dir-text">删除分类</span></div></div>';var v='<div class="nav-blank"><div class="add-nav"></div></div>';function u(){this.SUG_TPL=s;this.DIR_TPL=p}u.prototype={blankFy:function(){n.addClass("block-blank");$(".s-mblock-content",n).children().remove().end().removeAttr("style").unbind("mousedown mouseup click").removeClass("sui-componentWrap").html(v)},showDirs:function(a,e){var c;if((c=a.find(".nav-dirs-layer"))[0]){c.show()}else{var d='<div class="nav-dirs-layer"><div class="dir-item" data-dir="-1">未选择分类</div>{{~it.dirs :dir:index}}<div class="dir-item" data-dir="{{=dir.dirId}}">{{=dir.dirName}}</div>{{~}}</div>';var b=t.compile(d)({dirs:e.getNavData().dirs});a.append(b)}a.removeClass("showed").addClass("showed")},hideDirs:function(b,a){var c;if((c=b.find(".nav-dirs-layer"))[0]){c.hide()}b.removeClass("showed")},initPlaceHolder:function(a){F.use("superui:component/placeholder",function(b){a.nameHolder=new b({componentWrap:$(".sug-name-wrap",a.AddPannel.body),top:1,left:29,identity:"mineAddSug",target:$(".sug-name",a.AddPannel.body),holderText:"名称",height:30,lineheight:30});a.netHolder=new b({componentWrap:$(".sug-link-wrap",a.AddPannel.body),top:1,left:14,identity:"mineAddSug",target:$(".sug-link",a.AddPannel.body),holderText:"网址",height:30,lineheight:30})})},pannelSwitch:function(b,c,a){if(b==1){$(".nav-sug-wrap",c.body).addClass("classify");a.sugInstance[0].options("width",531);a.sugInstance[1].options("width",531)}else{$(".nav-sug-wrap",c.body).removeClass("classify");a.sugInstance[0].options("width",681);a.sugInstance[1].options("width",681)}},initTips:function(a,b){b.successTips=new l({target:b,identity:"navsugsccuss",content:"添加成功!",timing:2000,icons:"success",align:"center",theme:"white",arrowUp:false,autoShow:false,theme:"nav-success"});b.warnTips=new l({target:b,identity:"navsugwarn",content:"您已添加过该网址！",timing:2000,icons:"warning",theme:"white",align:"center",arrowUp:false,autoShow:false,theme:"nav-success"});b.alertTips=new l({target:b,identity:"navsugalert",content:"添加超过上限!",timing:2000,icons:"warning",theme:"white",align:"center",arrowUp:false,autoShow:false,theme:"nav-success"});for(var c in a.sugTwo){a.sugTwo[c].errorTips=new l({target:a.sugTwo[c],identity:"navsugerror",content:"请输入有效网址",timing:2000,arrowDown:false,icons:"error",theme:"white",align:"left",autoShow:false});a.sugTwo[c].failTips=new l({target:a.AddPannel.body.find(".sug-content"),identity:"navsugfail",content:"系统升级中，暂不支持添加此网址。小度正在尽全力恢复服务，我们对此深感抱歉！",timing:2000,arrowDown:false,arrowLeft:"center",icons:"error",theme:"white",align:"center",arrowUp:false,autoShow:false})}},dirTips:function(c,a){var b=this;if(!b[c]){b[c]=new l({target:$(".tool-add-dir",n),identity:"navsugsccuss",content:a,timing:2000,model:"left",arrowDown:false,arrowLeft:"center",icons:"error",theme:"white",align:"center",autoShow:false})}b[c].show()},initSug:function(b){var d=b.sugTwo[0];var c=b.sugTwo[1];b.sugInstance=[];F.use("superui:component/suggestion",function(e){b.sugInstance[0]=new e({componentWrap:$(".sug-content",b.AddPannel.body),identity:"navAddPannel",input:d,width:b.sugWidth,url:"//www.baidu.com/sugrec?wd={wd}&prod=open_superpage&json=1",template:s,autoFill:null,focusShow:false});b.sugInstance[1]=new e({componentWrap:$(".sug-content",b.AddPannel.body),identity:"navAddPannel",input:c,posRefer:d,width:b.sugWidth,url:"//www.baidu.com/sugrec?wd={wd}&prod=open_superpage&json=1",template:s,autoFill:null,focusShow:false})});for(var a=0;a<2;a++){b.sugInstance[a].on("onSelect",function(e){c.val(e[1]);d.val(e[4]);if($.isIE<=9){b.nameHolder.hide();b.netHolder.hide()}})}},showIndir:function(a,c){var d=this;var e=$(".edit-indir",n);var b=$(".edit-tool .edit-add",n);if(a){if(!d.IndirHolder){F.use("superui:component/placeholder",function(f){d.IndirHolder=new f({componentWrap:$(".edit-indir",n),top:5,left:10,identity:"mineAddDir",target:$(".tool-add-dir",n),holderText:"快速创建分类",height:22,lineheight:22})})}e.show();b.hide()}else{e.find(".tool-add-dir").val("");e.hide();b.show()}if(c){e.hide();b.hide()}},getTopDom:function(){return n},cSugMaker:function(b){this.C_SUG_TPL='<div class="nav-sug-wrap#{classsi}"><div class="sug-name-wrap"><input type="text" class="sug-name"/></div><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-my-dirs"><input class="sug-dir-input" value="未选择分类" data-dir="-1" readonly="readonly" disabled="disabled"/><div class="input-icon"></div></div><div class="sug-button">添加网址</div></div>';var a=b=="1"?" classify":"";return $.formatString(this.C_SUG_TPL,{classsi:a})},itemMaker:function(b,c,a){var d=b==="1"?"d-nav-item":"nav-item";var e='<div class="<&$oneItem.typeClass&> new-added" data-nav="<&$oneItem.id&>" data-url="<&$oneItem.url&>"><a class="border-for-item" href="<&$oneItem.url&>" target="_blank"><div class="nav-del"><div class="del-icon"></div></div><img src="<&$oneItem.iconUrl&>" alt="<&$oneItem.name&>" height="16" width="16" class="nav-icon"/><div class="nav-text"><span class="nav-text-content"><&$oneItem.name|sp_escape_html&></span></div></a></div>';return m.template(e,{varname:"oneItem"})({typeClass:d,id:c.id,iconUrl:$.url.escapeSSL(c.iconUrl),name:c.name,url:c.url})},pItemTpl:function(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}" data-url="{{=item.url}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'},editConMaker:function(a){return'<input type="text" value="'+a+'" class="edting-dir-name" maxlength="19"/>'}};return new u()});F.module("mantpl:nav/mine",function(H,I,V){var ak=H("mantpl:nav/mine_view");var R=H("superui:component/tips");var ai=$.parseJSON($.trim($("#s_minenav_textarea").html()));var Q=0;var X=ak.getTopDom();var ae=null;var J=H("superui:component/draggdirs");var S=H("superui:component/draggsort");var ad=H("superui:component/dialog");var T=H("superui:component/placeholder");var U=H("superui:util/smDot");var P="d-drag-item";var ac="dir-item";var ah="dir-blank";var N=ak.SUG_TPL;var ag=ak.DIR_TPL;var af=256;var M=U.template('<div class="nav-edit-name" data-id="<&$it.id&>" data-dir="<&$it.dirId&>" url="<&$it.url&>"><input value="<&$it.name&>"/></div><div class="nav-edit-url"><input value="<&$it.url&>"/></div>',{varname:"it"});var L=1;function Z(a){F.inherit(O,a);ae=new O()}function O(){this.constructor();this.id=L;this.blockDom=X;this.recomBlock="nplus";this.editDom=$(".edit-tool",X);this.reqParam={refreshParam:{isClassify:ai.isClassify}};if(ai.navCount==="0"){this.isBlank=true}this.isClassify=ai.isClassify;this.sorted=false;this.draggSort=null;this.draggClass=null;this.init();this.initEditTips();this.hasPannelBody=true;this.bindEvent();this.domTip=null;this.allDom=$("#s_content_100")}O.prototype={bindEvent:function(){var a=this;X.delegate(".edit-class","click",function(b){if(a.isSimp==true){a.expand()}if($(this).hasClass("classed")){$(this).removeClass("classed");a.classFyAction()}else{$(this).addClass("classed");a.unClassFyAction()}V.fire("navOpration",{oprateMod:L,opration:$(this).hasClass("classed")?"classed":"unclassed"})}).delegate("."+P,"mouseenter mouseleave",function(b){if(b.type==="mouseenter"){$("."+ac,X).attr("CANCELDRAG",1)}else{if(!$(this).attr("CANCELDRAG")){$("."+ac,X).removeAttr("CANCELDRAG")}}}).delegate(".edit-add","click",function(b){ak.showIndir.call(a,true);b.stopPropagation()}).delegate(".edit-indir","click",function(b){b.stopPropagation()}).delegate(".dir-enter","click",function(b){var c=$(this).parents(".edit-indir");a.addDir(c.find(".tool-add-dir").val())}).delegate(".dir-cancel","click",function(b){ak.showIndir.call(a,false)}).delegate(".add-nav","click",function(b){a.add()}).delegate(".border-for-item","click",function(b){if(X.hasClass("edting-block")){b.preventDefault()}else{if(a.contentDom.hasClass("block-nav-fanli")&&!!$(this).attr("data-fanliurl")){var c=$(this).attr("data-fanliurl");window.open(c);V.fire("mNavClick",{oprateMod:L,opration:"navclick",url:c});b.preventDefault()}else{var c=$(this).attr("href");V.fire("mNavClick",{oprateMod:L,opration:"navclick",url:c})}}$(this).parents("[data-nav]").removeClass("new-added")}).delegate(".edting-dir-name","mousemove dragstart focusout",function(b){if(b.type==="dragstart"){b.preventDefault()}b.stopPropagation();if(b.type==="focusout"){a.dirRename($(b.target))}}).delegate(".dir-item","mousedown",function(b){if(!$(b.target).hasClass("edting-dir-name")&&X.hasClass("edting-block")){b.preventDefault()}}).delegate(".s-fanli-tag","click",function(b){var c=$(this).attr("data-fanlimall");window.open(c);V.fire("mNavClick",{oprateMod:L,opration:"navclick",url:c});b.stopPropagation();b.preventDefault()}).delegate(".nav-item-edit","click",function(e){var f=$(this).parents(".border-for-item");var g=f.offset();var c=f.width();var d=a.allDom.offset();var j=$.trim(f.find(".nav-text-content").html());var h=$(this).parents("[data-nav]").attr("data-nav");var i=$(this).parents("[data-nav]").attr("data-url");var b=$(this).parents(".dir-item").attr("data-dir")||0;a.editDialog.window.find(".sui-dialog-body").html(M({name:j,url:i,id:h,dirId:b}));a.editDialog.show();if($.isIE==6){a.editDialog.mask.height($("#s_content_100").height())}a.editDialog.window.css({left:(g.left-d.left+af)>a.editDialog.mask.width()?g.left-d.left+c-af:g.left-d.left,top:g.top-d.top,marginLeft:0,marginTop:0})});$(".tool-add-dir").bind("keydown",function(d){var c=d.keyCode?d.keyCode:d.which?d.which:d.charCode;if(c===13){d.returnValue=false;var b=$(this).parents(".edit-indir");a.addDir(b.find(".tool-add-dir").val())}})},initEditTips:function(){var a=this;this.editDialog=new ad({componentWrap:$("#s_xmancard_mine"),identity:"minenavtips",content:"我是内容",buttons:["确定","取消"],autoShow:false,hasClose:false,width:af,theme:"nav-edit"});this.editDialog.on("acting-ok",function(){var b=$(".nav-edit-name").attr("data-id");var c=$.trim($(".nav-edit-url").find("input").val());c=c==$(".nav-edit-name").attr("url")?"":c;$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"modify",dirId:"",id:b,tabid:L,name:$.trim($(".nav-edit-name").find("input").val()),url:c},function(f){if(f.errNo==0){var d=f.data;var e=$("div[data-nav="+b+"]",X);e.find(".nav-text-content").html(d.name);e.find("a").attr({title:d.name,href:d.url});e.attr({"data-nav":d.id,"data-url":d.url});$(".nav-edit-name[data-id="+b+"]",X).attr("url",d.url);e.find("img").attr("src",$.url.escapeSSL(d.iconUrl));a.editDialog.hide()}else{a.editNavTipsCheck(a.editDialog.body.find(".nav-edit-url"),aa(f));a.editNavTips.show()}});if($.isIE<=10){window.event.returnValue=false}return false})},getNavData:function(){return ai},dirRename:function(e){var c=e.val();var f=e.parents("[data-dir]").attr("data-dir");var d=this;if(c!=""){var a=false;$(".dir-name .name-text",X).each(function(){if($.trim($(this).html())==c&&$(this).parents("[data-dir]").attr("data-dir")!=f){a=true;d.editDirTips(d.dialog.body.find(".edting-dir-name"))}});if(!a){e.parents(".dir-name").find(".name-text").html(c);if(d.AddPannel){var b=e.parents("[data-dir]").attr("data-dir");$('.nav-dirs-layer [data-dir="'+b+'"]',d.AddPannel.body).html(c)}d.draggFetch({cmd:"rename_dir",dirId:f,dirName:c})}}},classFyAction:function(){var a=this;a.classify(false,function(){$(".edit-add",X).hide();$("."+ah,X).hide()});a.contentDom.addClass("block-classed");ai.isClassify="1";ak.showIndir.call(a,false)},unClassFyAction:function(){var a=this;a.classify(true,function(){$(".edit-add",X).show();$("."+ah,X).show()});a.contentDom.removeClass("block-classed");ai.isClassify="0";ak.showIndir.call(a,false)},refreshCb:function(c,d){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(c.html).filter(".s-mblock-content");$(".s-block-container",X).append(this.contentDom);ai=$.parseJSON($.trim($("#s_minenav_textarea").html()));Q=0;this.sorted=false;this.isBlank=!parseInt(ai.navCount);if(s_session.sid.indexOf("18096")>-1||s_session.sid.indexOf("18097")>-1){var a=/mine-title-num[^\(]+\([^\d]+(\d+)/gi,b;b=a.exec(c.html);$(".mine-title-num span",X).html(b[1])}},editCb:function(){if(this.isSimp==true){this.expand()}$("."+ac,X).show();if(!this.sorted){if(ai.isClassify==="1"){this.draggClass=aj.call(this,true,this.draggFetch)}else{this.draggSort=aj.call(this,false,this.draggFetch)}this.sorting=true}else{$("."+P,X).removeAttr("CANCELDRAG")}if(ai.isClassify==="1"){$("."+ah,X).show();this.draggClass.draggAll.collapse();this.draggClass.draggAll.sort(null,true);ak.showIndir(false)}else{ak.showIndir(false,true)}$(".dir-name",X).each(function(){$(".edting-dir-name",this).val($.trim($(".name-text",this).html()))});$(".edting-block .d-nav-item .border-for-item").addClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");$(".edting-block .nav-item .border-for-item").addClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");this.editDom.show()},unEditCb:function(){$(".nav-item .border-for-item").removeClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");$(".d-nav-item .border-for-item").removeClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");var a=this;$("."+P,X).attr("CANCELDRAG","1");$("."+ac,X).attr("CANCELDRAG","1");if(ai.isClassify==="1"){$("."+ah,X).hide();a.draggClass.draggAll.collapse();a.draggClass.draggAll.sort(null,true)}if($("."+P,X).length==0){a.isBlank=true;a.contentDom.addClass("block-blank");a.refresh()}$(".edit-indir",X).hide().val("");$(".edit-add",X).show();a.sorting=false;a.editDom.hide()},classify:function(c,b){var a=this;a.reqParam.refreshParam.isClassify=c?1:0;a.refresh(function(d){a.refreshCb(d);b&&b();if(c){$("."+ah,X).hide()}})},draggFetch:function(a){am.call(this,a,function(b){})},editDirTips:function(a){var b=this;if(!b.editTips){b.editTips=new R({target:a,identity:"dirrepeat",content:"目录名重复",timing:2000,arrowDown:false,arrowLeft:"center",icons:"error",theme:"yellow",align:"center",arrowUp:false,autoShow:true})}else{b.editTips.hide();b.editTips.target=a;b.editTips.show()}},editNavTipsCheck:function(c,b){var a=this;a.editNavTips=new R({target:c,identity:"navcheck",content:b,timing:2000,arrowLeft:30,icons:"error",theme:"yellow",align:"left",arrowUp:false,autoShow:true})},pannelParam:function(){this.sugWidth=681;if(ai.isClassify=="1"){this.sugWidth=531}var a=ak.cSugMaker(ai.isClassify);return{sugTpl:a,title:"添加网址",itemTpl:ak.pItemTpl()}},addCb:function(b){var a=this;if(a.isSimp==true){a.expand();a.isSimp=false}if(!b){ak.pannelSwitch(ai.isClassify,a.AddPannel,a);a.AddPannel.window.css({top:Math.min(100+$(window).scrollTop(),$("#s_wrap").height()+$("#head_wrapper").height()-a.AddPannel.window.height())});return}a.AddPannel.window.css({top:Math.min(100+$(window).scrollTop(),$("#s_wrap").height()+$("#head_wrapper").height()-a.AddPannel.window.height())});a.sugTwo=[$(".sug-name",a.AddPannel.body),$(".sug-link",a.AddPannel.body)];var c=$(".sug-dir-input",a.AddPannel.body);ak.initPlaceHolder(a);ak.initSug(a);this.domTip=$(".nav-sug-wrap");ak.initTips(a,a.domTip);a.AddPannel.body.delegate(".sug-button","click",function(h){var f=-1;var e=0;var g=Y(a.sugTwo[0].val(),a.sugTwo[1].val());if(!g.suc){a.sugTwo[g.tipPos].errorTips.show();a.sugTwo[g.tipPos].val("").focus();for(var d in a.sugTwo){a.sugInstance[d].clearResult()}return}a.add2Dir({navName:a.sugTwo[0].val(),link:g.url},c,function(j){for(var i in a.sugTwo){a.sugTwo[i].val("").focus();a.sugInstance[i].hide();a.sugInstance[i].clearResult()}a.domTip.successTips.show();$(".sug-dir-input").val("未选择分类").attr("data-dir","-1");ak.hideDirs($(".sug-my-dirs"),a)})}).delegate(".sug-my-dirs","click",function(d){if($(this).hasClass("showed")){ak.hideDirs($(this),a)}else{ak.showDirs($(this),a)}d.stopPropagation()}).delegate(".dir-item","click",function(d){c.attr("data-dir",$(this).attr("data-dir"));c.val($(this).html());ak.hideDirs($(".sug-my-dirs"),a);$(".nav-dirs-layer",a.AddPannel.body).hide();d.stopPropagation()}).on("click",function(d){ak.hideDirs($(".sug-my-dirs"),a)});a.AddPannel.on("onHide",function(d){return;ak.hideDirs($(".sug-my-dirs"),a);a.sugTwo[0].val("");a.sugTwo[1].val("");if(a.addHappen){setTimeout(function(){a.addHappen=false},500)}V.fire("navOpration",{oprateMod:L,opration:"closeWindow"})});a.AddPannel.componentWrap.on("click",function(d){ak.hideDirs($(".sug-my-dirs"),a)})},recomAddCb:function(a,b,c){this.add2Dir({navName:$.trim(a.find(".recom-text").html()),link:a.attr("data-url"),target:a},null,b,c)},recomDelCb:function(a,b){this.delItem({navName:$.trim(a.find(".recom-text").html()),link:a.attr("data-url"),navId:a.attr("data-id")},b)},add2Dir:function(d,f,e,c){var b=this;var a=d.link;try{a=decodeURIComponent(d.link)}catch(h){a=d.link}var g={cmd:"add",from:"u_layer",name:d.navName,url:a,customDirId:f?(f.attr("data-dir")||-1):-1};am.call(this,g,function(i){c&&c();if(i.errNo=="6004"){b.domTip.warnTips.show();return false}else{if(i.errNo=="501"){b.domTip.alertTips.show();return false}else{if(i.errNo=="500"){b.sugTwo[0].failTips.target=d.target||b.sugTwo[0];b.sugTwo[0].failTips.show();return false}else{if(parseInt(i.errNo)!=0){b.sugTwo[0].failTips.target=d.target||b.sugTwo[0];b.sugTwo[0].failTips.show();return false}}}}if(b.isBlank){b.isBlank=false;$(".set-menu",X).removeClass("blank-menu");b.sorted=false;setTimeout(function(){b.refresh(function(j){b.contentDom.unbind("mousedown mouseup click").children().remove().end().html("").removeClass("block-blank");b.refreshCb.call(b,j);$(".nav-item",b.contentDom).addClass("new-added")})},800)}else{b.addItem(i.data)}e&&e(i)})},addItem:function(g,e){var j=this;var d=ak.itemMaker(ai.isClassify,g,j);var a=g.dirId;var i=null;var h=null;if(!j.sorted){if(ai.isClassify==="1"){i=$('[data-dir="'+a+'"] .dir-content',X);$('[data-dir="'+a+'"]',X).show().removeClass(ah)}else{i=$(".s-mblock-content",X)}j.trimDom(i);i.append(d)}else{if(ai.isClassify==="1"){for(var f in j.draggClass.draggdirs){var a=j.draggClass.draggdirs[f].selected.componentWrap.parents("[data-dir]").attr("data-dir");if(a===g.dirId){h=j.draggClass.draggdirs[f].selected;break}}}else{h=j.draggSort}var b=$(d).addClass("d-drag-item").css({position:"absolute"});if(!j.sorting){b.attr("CANCELDRAG",1)}var c;h.append(b);h.sort(null,true);if((c=h.componentWrap.parents("[data-dir]")).hasClass(ah)){c.removeClass(ah).show();j.draggClass.draggAll.collapse();$(".sui-draggsort-holder",c).hide()}if(ai.isClassify==="1"){j.draggClass.draggAll.collapse();j.draggClass.draggAll.sort(null,true)}}},delItem:function(b,d){var c=this;var e=b.navId;if(!c.sorted){var a={cmd:"del_nav",name:b.navName,url:b.link,ids:e,customDirId:"-1"};am.call(this,a,function(g){if(ai.isClassify=="1"){var f=$('[data-nav="'+e+'"]',X).parents(".dir-item");if(f.find(".d-nav-item").length==1){f.addClass("dir-blank").hide()}$('[data-nav="'+e+'"]',X).remove()}else{$('[data-nav="'+e+'"]',X).remove()}d&&d();c.addHappen=true})}else{$('[data-nav="'+e+'"] .del-icon',X).trigger("click");if(ai.isClassify==="1"){$("."+ah,X).hide();c.draggClass.draggAll.collapse();c.draggClass.draggAll.sort(null,true)}d&&d()}},addDir:function(b){var a={cmd:"add_dir",dirName:b};var d=0;$(".dir-name .name-text",X).each(function(){if($.trim($(this).html())==b){d=1}else{if(b==""){d=2}}});if($(".dir-item",X).length>=30){d=3}if(d===1){ak.dirTips("repeatTip","该分类已存在");return false}else{if(d===2){ak.dirTips("emptyTip","名称不能为空");return false}else{if(d===3){ak.dirTips("emptyTip","添加超过上限");return false}}}var c=this;$(".tool-add-dir",X).val("");am.call(this,a,function(e){var h=e.data.dirId;var j=e.data.dirName;var f=$.formatString(ag,{dirName:j,dirId:h});var i=$(f);var k=c.draggClass.draggAll;k.append(i);k.sort(null,true,function(){var l=K.call(i.find(".dir-content"),c.draggClass.draggdirs,c.draggClass.draggAll);l.checkData();c.draggClass.draggdirs.push(l)});var g='<div class="dir-item" data-dir="'+h+'">'+j+"</div>";$(".nav-dirs-layer").append(g);ai.dirs.push({dirId:h,dirName:j})});ak.showIndir.call(c,false)},fanli:function(c){var a=$(".fanli-class",X);var b=this;a.toggleClass("classed");if(a.hasClass("classed")){b.contentDom.removeClass("block-nav-fanli").addClass("block-nav-fanli")}else{b.contentDom.removeClass("block-nav-fanli")}F.use("superman:common/user_attr",function(d){d.setAttr("navQuanyiTip",a.hasClass("classed"))})}};function am(a,b){a=F.mix(a,{tabid:1});$.ajaxpost("/home/subscribe/submit/manoperation",a,function(c){b&&b(c);V.fire("navOpration",{oprateMod:L,opration:a.cmd.replace("_","-")});if(parseInt(c.errNo)===0){if(a.cmd==="add"){var d=$(".mine-title-num span",X);d.html(parseInt(d.html())+1)}else{if(a.cmd==="del_nav"){var d=$(".mine-title-num span",X);d.html(parseInt(d.html())-1)}}}})}function aj(a,b){this.sorted=true;if(a){$(".dir-item .d-nav-item",X).addClass(P);return al.call(this,b)}else{$(".nav-item",X).addClass(P);return ab.call(this,b)}}function ab(c){var b=new S({componentWrap:$(".s-mblock-content",X),identity:"minenav",dragsort:"."+P,dragHandle:".h",delAble:true,delSelector:".nav-del .del-icon",containment:$(".s-mblock-content",X),placeholder:false,preventDefault:false});var d={};var e="";b.drags.each(function(){var f=$(this).attr("data-daraggsort");d[f]=$(this).attr("data-nav")});var a=$(".s-mblock-content",X);b.on("onAfterSort",function(g){e="";for(var h=0,j=g.cache,k=j.length;h<k;h++){var i=a.find('[data-daraggsort="'+j[h]+'"]');if(h==0){e=i.attr("data-nav");continue}e+=","+i.attr("data-nav")}var f={cmd:"seq_in",seqid:g.dragItem.attr("data-nav"),dirId:0,ids:e};c&&c(f)}).on("onSortDel",function(g){var h=g.delItem.attr("data-nav");var f={cmd:"del_nav",ids:h,dirIds:"0",isNplus:"0"};Q++;c&&c(f);if(s_session.sid.indexOf("18096")>-1||s_session.sid.indexOf("18097")>-1){V.fire("navunsubscribe",{id:g.delItem.attr("data-nav")})}});return b}function al(d){var a=W.call(this,d);var b=[];$(".dir-item .dir-content",X).each(function(){K.call(this,b,a,d)});for(var c in b){b[c].checkData()}return{draggAll:a,draggdirs:b}}function K(e,a,d){var c=$(this).parents("[data-dir]").attr("data-dir");var b=new J({cansort:true,identity:"minenav",dragsort:"."+P,dirId:c,dir:$(this),delAble:true,containment:$(".s-mblock-content",X),delSelector:".nav-del .del-icon",blankClass:ah,preventDefault:false});e.push(b);b.on("onAfterSelect",function(h){var i={};h.fromSort.drags.each(function(){var o=$(this).attr("data-daraggsort");i[o]=$(this).attr("data-nav")});if(h.changed===true){var l={};h.toSort.drags.each(function(){var o=$(this).attr("data-daraggsort");l[o]=$(this).attr("data-nav")});var j="";var m="";for(var g=0,n=h.fromSort.cache,f=n.length;g<f;g++){if(g==0){j=i[n[g]];continue}j+=","+i[n[g]]}for(var g=0,n=h.toSort.cache,f=n.length;g<f;g++){if(g==0){m=l[n[g]];continue}m+=","+l[n[g]]}var k={cmd:"seq_out",fromDirId:h.fromSort.componentWrap.parents(".dir-item").attr("data-dir"),toDirId:h.toSort.componentWrap.parents(".dir-item").attr("data-dir"),fromIds:j,toIds:m,seqid:h.dragItem.attr("data-nav")};d&&d(k)}else{var j="";for(var g=0,n=h.fromSort.cache,f=n.length;g<f;g++){if(g==0){j=i[n[g]];continue}j+=","+i[n[g]]}var k={cmd:"seq_in",ids:j,seqid:h.dragItem.attr("data-nav"),dirId:h.fromSort.componentWrap.parents(".dir-item").attr("data-dir")};d&&d(k)}}).on("onExchange",function(f){a.sort(null,true);a.collapse()}).on("onDel",function(g){var h=g.dataNav;var i=g.dataDir;var f={cmd:"del_nav",isNplus:"1",dirIds:i,ids:h};Q++;d&&d(f);g.fromSort.blankFy();a.sort(null,true);a.collapse()});return b}function aa(b){var a="";switch(parseInt(b.errNo)){case 6004:a="该网址已存在";break;case 6001:a="导航已满，请删除不常用网址";break;case 6014:a="分类不存在";break;default:a="添加失败"}return a}function Y(f,g){var a=$.trim(g);var d="";var b="";var e=true;var c=a.match(/^(http|ftp|https):\/\//);f=$.trimAll($.trim(f));if(!c){a="http://"+a}if(!/^(http|ftp|https):\/\/([\w-]+(:[\w-]+)?@)?[\w-]+(\.[\w-]+)+(:[\d]+)?([#\/\?][^\s<>;"\']*)?$/.test(a)){d="请输入有效网址";b=1;src="url";e=false}else{if(a.length>1024){d="网址超长！";b=1;src="url";e=false}else{if(!f){src="name";d="请输入名称";b=0;e=false}else{if(new RegExp("<|>|'|\"|/|\\\\").test(f)){d="导航名称不能包含 ' \" < > \\ / 等特殊字符。";b=0;src="name";e=false}else{if(f.length>128){d="名称超长！";b=0;src="name";e=false}}}}}return{suc:e,tip:d,tipPos:b,url:a,name:f}}function W(b){var a=new S({componentWrap:$(".s-mblock-content",X),identity:"minenav",dragsort:"."+ac,dragHandle:".h",placeholder:false,oneColDiff:true,delAble:true,containment:$(".s-mblock-content",X),delSelector:".del-dir",saveEnergy:false,preventDefault:false});var c={};a.drags.each(function(){var d=$(this).attr("data-daraggsort");c[d]=$(this).attr("data-dir")});a.on("onAfterSort",function(f){var d="";for(var g=0,h=f.cache,i=h.length;g<i;g++){if(g==0){d=c[h[g]];continue}d+=","+c[h[g]]}var e={cmd:"seq_dir",dirIds:d,dirId:f.dragItem.attr("data-dir")};b&&b(e)}).on("onSortDel",function(d){var g={cmd:"del_dir",dirIds:d.delItem.attr("data-dir")};$(".nav-dirs-layer").find('[data-dir="'+g.dirIds+'"]').remove();var h=-1;for(var e=0,f=ai.dirs.length;e<f;e++){if(ai.dirs[e].dirId==g.dirIds){h=e}}ai.dirs.splice(h,1);b&&b.call(ae,g)});return a}I.init=Z});F.addLog("mantpl:nav",{navOpration:"1100002001",mNavClick:"1100003001"});F.module("mantpl:stock/mine",function(z,J,t){var B=null;var H=$.parseJSON($.trim($("#s_minestock_textarea").html()));var w=$("#s_xmancard_mine .s-block-stock");var D="stock-item";var A=12;var E=z("superui:util/smDot");var v='<span class="sp-sg-code">{{=it["code"]}}</span><span class="sp-sg-name">{{=it["name"]}}</span><span class="sp-sg-market">{{=it["market"]}}</span>';var C=E.template($(".tpl-area",w).text(),{varname:"oneStock"});E.template("",{varname:"it"});function x(a){F.inherit(u,a);B=new u()}function u(){this.constructor();this.id=A;this.blockDom=w;this.recomBlock="stock";this.editExpand=true;this.init();this.bindEvent()}u.prototype={freshDom:function(a,b){var d=this;var f="";var e=0;if(b){d.contentDom.unbind("mousedown mouseup click").children().remove();d.contentDom.remove();d.contentDom=b;w.find(".s-block-container").append(d.contentDom);a=$.parseJSON($.trim($("#s_minestock_textarea",b).html())).stocks;var e=a.length;if(e>0){d.isBlank=false;d.sorted=false;$(".stock-banner",w).removeClass("stock-banner-hide")}else{$(".stock-banner",w).addClass("stock-banner-hide")}$(".mine-title-num span",w).html(e);return}for(var c in a){f+=y.call(d,a[c]);e++}if(e>0){d.isBlank=false;d.sorted=false;d.contentDom.unbind("mousedown mouseup click").children().remove().end().html(f);$(".stock-banner",w).removeClass("stock-banner-hide")}else{d.blankfy()}},refreshCb:function(a){if(this.isSimp===true){this.expand()}this.freshDom(null,$(a.html).filter(".s-mblock-content"))},bindEvent:function(){var a=this;w.delegate(".add-stock","click",function(b){a.add()}).delegate(".stock-item .stock-link","click",function(c){var e=$(this).parents(".stock-item");if(e.attr("canceldrag")=="1"||!e.attr("data-daraggsort")){var b="";if(e.attr("data-market")==="stockus"){b+=" 美股"}else{b+=" 股票"}var d="//www.baidu.com/s?wd="+e.data("code")+b+"&ie=utf-8&tn=SE_baiduhomet1_zehq5d4k&rsv_idx=2";window.open(d);t.fire("stockClick",{oprateMod:A,opration:"stockclick",url:d})}})},editCb:function(){if(this.isSimp===true){this.expand()}if(!this.sorted){M.call(this,this.draggFetch)}else{$("."+D,w).removeAttr("CANCELDRAG")}},unEditCb:function(){var a=this;if($(".stock-item",w).length===0){a.isBlank=true}$("."+D,w).attr("CANCELDRAG","1");if($("."+D,w).length==0){a.refresh()}},blankfy:function(){var a='<div class="stock-blank"><div class="add-stock"></div></div>';this.isBlank=true;this.contentDom.children().remove().end().addClass("block-blank").html(a);$(".stock-banner",w).addClass("stock-banner-hide")},draggFetch:function(a){K.call(this,a,function(b){})},pannelParam:function(){this.sugWidth=681;var a=G();return{sugTpl:a,title:"添加股票",itemTpl:L(),content:'<div class="pannel-content"><div class="sug-content">'+a+"</div></div>",height:120,top:210}},addCb:function(b){var a=this;if($.isIE===6){$(".sui-dialog-stock-pannel").css({top:"+="+$(window).scrollTop()})}if(a.isSimp===true){a.expand()}if(!b){return}I.call(a);var c=a.AddPannel.componentWrap.find(".sui-dialog-stock-pannel .sug-link");a.AddPannel.body.delegate(".sug-button","click",function(d){a.addAction(c)}).delegate(".sug-link","keydown",function(d){if(d.keyCode==8){c.removeAttr("data-code").removeAttr("data-market")}}).delegate(".sug-link","click",function(d){if(a.sugInstance.cache){a.sugInstance.show()}});a.AddPannel.on("onhide",function(){c.val("").data("market","");a.sugInstance.cache=null;a.PlaceTips.show()})},addAction:function(a){var b=this;if(a&&a.val()!=""){if(!!a.attr("data-code")&&!!a.attr("data-market")){b.recomAddCb(a,function(){b.SuccessTips.show();a.val("").data("market","")})}else{if(b.sugInstance.resdata&&b.sugInstance.resdata.length>0){b.recomAddCb(null,function(){b.SuccessTips.show();a.val("").data("market","")},b.sugInstance.resdata[0].code,b.sugInstance.resdata[0].resourcename)}else{b.ErroTips.show()}}a.attr("data-code","");a.attr("data-market","");b.sugInstance.cache=null}},recomAddCb:function(h,f,j,e){var c=H.stocks;var e=h?h.attr("data-market"):e;var j=h?h.attr("data-code"):j;var g="";var b="_";var d=0;var i=this;var a=$(".stock-item",w);g=e+":"+j;this.addStock({stockcode:j,resourcename:e,rscids:g},f);return true},recomDelCb:function(a){this.delItem(a.data("code"),a.data("market"))},addStock:function(b,d){var c=this;var a={cmd:"add",rscids:b.rscids};K.call(c,a,function(e){if(a.cmd=="add"){if(e.errNo=="501"&&a.cmd=="add"){B.alertTips.show();return}else{if(e.errNo=="500"&&a.cmd=="add"){B.warnTips.show();return}else{if(e.errNo!="0"){B.failTips.show();return}}}}d&&d();H.stocks=[];for(var f in e.data.items){H.stocks.push(e.data.items[f])}c.freshDom(e.data.items)})},delItem:function(b,e){var d=this;if(!d.sorted){var c="";$(".stock-item",w).each(function(){c+=e+":"+b+"_"});$('.stock-item[data-code="'+b+'"]',w).remove();c=c.substr(0,c.length-1);var a={cmd:"del",rscids:c};d.draggFetch.call(this,a)}else{$('[data-code="'+b+'"] .del-icon',w).trigger("click")}}};function I(){var a=this;F.use("superui:component/suggestion",function(b){a.sugInstance=new b({componentWrap:$(".sug-content",a.AddPannel.body),identity:"stockAddPannel",input:$(".sug-link",a.AddPannel.body),width:691,url:"//www.baidu.com/sugrec?wd={wd}&prod=open_finance_stock&json=1",template:v,autoFill:null,focusShow:false})});F.use("superui:component/tips",function(b){a.ErroTips=new b({target:$(".sug-link",a.AddPannel.body),componentWrap:a.AddPannel.body,identity:"navsugerror",content:"请输入有效信息",timing:2000,model:"left",icons:"error",align:"left",arrowDown:false,theme:"white",autoShow:false});a.warnTips=new b({target:$(".sug-link",a.AddPannel.body),identity:"navsugerror",componentWrap:a.AddPannel.body,content:"您已添加过该股票",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});a.SuccessTips=new b({target:$(".sug-link",a.AddPannel.body),identity:"navsugerror",componentWrap:a.AddPannel.body,content:"添加成功",timing:2000,model:"left",arrowDown:false,icons:"success",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});a.alertTips=new b({target:$(".sug-link",a.AddPannel.body),identity:"navsugalert",componentWrap:a.AddPannel.body,content:"添加超过上限",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});a.failTips=new b({target:$(".sug-link",a.AddPannel.body),identity:"stocksugfail",componentWrap:a.AddPannel.body,content:"添加失败",timing:2000,model:"left",icons:"error",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"})});F.use("superui:component/placeholder",function(b){a.PlaceTips=new b({componentWrap:$(".sug-link-wrap",a.AddPannel.body),top:1,left:30,identity:"mineAddSug",target:$(".sug-link",a.AddPannel.body),holderText:"输入股票名称/代码/拼音",height:30,lineheight:30})});a.sugInstance.on("onSelect",function(b){$(".sug-link",a.AddPannel.body).val(b.code).attr("data-code",b.code).attr("data-market",b.resourcename)})}function y(a){return C(a)}function G(){var a='<div class="stock-sug-wrap"><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-button">添加股票</div></div>';return a}function L(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-code="{{=item.code}}" data-market="{{=item.market}}"><span class="recom-icon"></span><span class="recom-text">{{=item.title}}</span></div>'}function K(c,b){var a=this;c=F.mix(c,{tabid:A});$.ajaxpost("/home/subscribe/submit/manoperation",c,function(d){b&&b(d);if(parseInt(d.errNo)===0){if(c.cmd==="add"){var e=$(".mine-title-num span",w);e.html(parseInt(e.html())+1)}else{if(c.cmd==="del"){var e=$(".mine-title-num span",w);e.html(parseInt(e.html())-1)}}}t.fire("stockOpration",{oprateMod:A,opration:c.cmd.replace("_","-")})})}function M(c){var a=this;var b=a.sortFy({identity:"minestock",dragsort:"."+D,delSelector:".stock-del .del-icon",dataIdenti:"data-code",componentWrap:a.contentDom,containment:a.contentDom});this.sorted=true;var d={};var e="";this.draggsort=b;this.draggsort.on("onAfterSort",function(g){e="";var h=w.find(".s-mblock-content");var k=0;for(var m=0,f=g.cache,l=f.length;m<l;m++){var i=h.find('[data-daraggsort="'+f[m]+'"]');e+=i.attr("data-market")+":"+i.attr("data-code")+"_"}e=e.substr(0,e.length-1);var j={cmd:"seq_in",rscids:e,code:g.dragItem.attr("data-market")+":"+g.dragItem.attr("data-code"),pos:g.cache.indexOf(parseInt(g.dragItem.attr("data-daraggsort")))+1};c&&c.call(this,j)}).on("onSortDel",function(g){e=g.delItem.data("market")+":"+g.delItem.data("code");var f={cmd:"del",rscids:e};H.delStockCount=H.delStockCount?H.delStockCount+1:1;c&&c.call(a,f)})}J.init=x});F.addLog("mantpl:stock",{stockOpration:"1100002001",stockClick:"1100003001"});F.module("mantpl:video/mine",function(B,z,w){var v=$("#s_xmancard_mine .s-block-video");var q="video-item";var D='<span class="sp_sg_code">{{=it["code"]}}</span><span class="sp_sg_name">{{=it["name"]}}</span><span class="sp_sg_market">{{=it["market"]}}</span>';var y=$.parseJSON($.trim($("#s_minevideo_textarea").html()));var C=null;var E=15;var r=B("superui:component/dialog");function t(a){F.inherit(G,a);C=new G()}function G(){this.constructor();this.id=E;this.blockDom=v;this.recomBlock="video";this.contentDom=$(".s-mblock-content",v);this.editExpand=true;this.isBlank=!!parseInt(y.isBlank,10);this.init();this.bindEvent();this.hasAdd=false}G.prototype={bindEvent:function(){var a=this;v.delegate(".video-item","click",function(b){if(!a.sorted||$(this).attr("CANCELDRAG")){window.open($(this).data("href"));w.fire("videoLink",{oprateMod:E,opration:"click"})}}).delegate(".add-video","click",function(b){if($('#s_menus_wrapper [data-id="'+a.id+'"]')[0]){$('#s_menus_wrapper [data-id="'+a.id+'"]').trigger("click")}else{if(!a.blankAlert){a.blankAlert=new r({identity:"changeDir",content:"您还没有添加视频频道哦，快去添加！",hasClose:false,theme:"video-blank",buttons:[{type:"ok",title:"确定"}],autoShow:true});if($.isIE6){$(".sui-dialog-mask-video-blank").height($("body").height());$(".sui-dialog-video-blank").css({top:"+="+$(window).scrollTop()})}}else{a.blankAlert.show();if($.isIE6){$(".sui-dialog-mask-video-blank").height($("body").height())}}}})},editCb:function(){if(this.isSimp===true){this.expand()}if(!this.sorted){u.call(this,this.draggFetch)}else{$("."+q,v).removeAttr("CANCELDRAG")}},draggFetch:function(a){a=F.mix(a,{tabid:C.id});$.ajaxpost("/home/subscribe/submit/manoperation",a,function(b){if(a.cmd=="add"||a.cmd=="del"){}w.fire("videoOpration",{oprateMod:E,opration:a.cmd})})},unEditCb:function(){var a=this;$("."+q,v).attr("CANCELDRAG","1");if($("."+q,v).length===0){a.blankfy()}},refreshCb:function(a){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(a.html).filter(".s-mblock-content");$(".s-block-container",v).append(this.contentDom);$(".mine-title-num span",v).html($(".video-item",v).length);this.sorted=false;y=$.parseJSON($.trim($("#s_minevideo_textarea").html()));this.isBlank=(y.isBlank=="1")},blankfy:function(){var a='<div class="video-blank"><div class="add-video"></div></div>';this.isBlank=true;this.contentDom.children().remove().end().addClass("block-blank").html(a)},pannelParam:function(){this.sugWidth=681;var a=A();return{sugTpl:a,title:"添加视频",itemTpl:x()}},addCb:function(){var a=this;s.call(a)}};function x(){var a="";return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}"><span class="recom-icon"></span><span class="recom-text">{{=item.title}}</span></div>'}function A(){var a='<div class="stock-sug-wrap"><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-button">添加视频</div></div>';return a}function s(){var b=this;var c=b.Suggestion;var a=b.Tips;b.sugInstance=new c({componentWrap:$(".sug-content",b.AddPannel.body),identity:"videoAddPannel",input:$(".sug-link",b.AddPannel.body),width:691,url:$.url.escapeSSL("http://nssug.baidu.com/su?wd={wd}&prod=video&json=1"),template:D,autoFill:null});b.ErroTips=new a({target:$(".sug-link",b.AddPannel.body),identity:"videosugerror",content:"请输入有效信息",timing:2000,model:"left",arrowDown:false,icons:"error",theme:"white",autoShow:false});b.sugInstance.on("onSelect",function(d){$(".sug-link",b.AddPannel.body).val(d.code).data("id",d.id)})}function u(c){var a=this;var b=a.sortFy({identity:"minevideo",dragsort:"."+q,delSelector:".video-del .del-icon",dataIdenti:"data-id",componentWrap:a.contentDom,containment:a.contentDom});a.sorted=true;var d={};var e="";b.drags.each(function(){var f=$(this).attr("data-daraggsort");d[f]=$(this).data("id")});b.on("onAfterSort",function(i){e="";for(var j=0,f=i.cache,g=f.length;j<g;j++){e+=d[f[j]]+"_"}e=e.substr(0,e.length-1);var h={cmd:"seq_in",rscids:e};c&&c.call(a,h)}).on("onSortDel",function(g){var f={cmd:"del",id:g.delItem.data("id")};c&&c.call(a,f);w.fire("videounsubscribe",{id:g.delItem.data("id")});var h=$(".mine-title-num span",v);h.html(parseInt(h.html())-1)})}z.init=t});F.addLog("mantpl:video",{videoLink:"1100003001",videoOpration:"1100002001"});F.module("mantpl:xingzuo/mine",function(x,v,s){var q=$("#s_xmancard_mine .s-block-xingzuo");var w=null;var r=x("superui:component/draggsort");var p=7;var z="constel-item";function n(a){t.prototype=$.extend({},a.prototype,t.prototype);w=new t()}function t(){this.constructor();this.id=p;this.hasSimp=false;this.blockDom=q;this.recomBlock="xingzuo";this.contentDom=$(".s-mblock-content",q);this.hasPannelBody=true;this.isBlank=!parseInt($(".mine-title-num span",q).html(),10);this.init();this.bindEvent()}t.prototype={bindEvent:function(){var a=this;q.delegate(".detail-tab-item","click",function(c){var d=$(this).attr("data-tabname");var b=$(this).closest(".constel-pannel");$(".constel-detail .cur-tab",b).removeClass("cur-tab");$(this).addClass("cur-tab");$(".tab-contents [data-tabname="+d+"]",b).addClass("cur-tab");if(q.hasClass("edting-block")){$(".edit-comp",q).trigger("click")}s.fire("xingzuoOpration",{oprateMod:p,opration:"to"+d,curxingzuo:$(".constel-head .cur-pannel",q).attr("data-pannel")})}).delegate("."+z,"click",function(b){if(!!$(this).attr("data-daraggsort")&&!$(this).attr("CANCELDRAG")){return}a.switchPannel($(this))}).delegate(".add-constell","click",function(b){a.add()}).delegate(".more","click",function(b){if(q.hasClass("edting-block")){$(".edit-comp",q).trigger("click")}s.fire("xingzuoClick",{oprateMod:p,opration:"fortuneclick",url:$(this).attr("href")})})},switchPannel:function(b){var a={cmd:"switch",tabname:""};if(b){$(".cur-pannel",q).removeClass("cur-pannel");var c=b.attr("data-pannel");b.addClass("cur-pannel");var d=$(".constel-content [data-pannel="+c+"]",q);$("[data-src]",d).each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")});d.addClass("cur-pannel");a.tabname=c}y(a)},editCb:function(){var a=this;if(this.isSimp==true){this.expand()}if(!$("."+z,q).attr("data-daraggsort")){o.call(a)}else{$("."+z,q).removeAttr("CANCELDRAG")}},unEditCb:function(){var a=$(".constel-head ."+z,q);if(a.length===0||(a.length===1&&!data)){this.blankFy()}else{$("."+z,q).attr("CANCELDRAG",1)}},refreshCb:function(a){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(a.html).filter(".s-mblock-content");$(".s-block-container",q).append(this.contentDom);$(".mine-title-num span",q).html($(".constel-head .constel-item",q).length);this.isBlank=!parseInt($(".mine-title-num span",q).html(),10)},pannelParam:function(){return{sugTpl:"",title:"添加星座",itemTpl:u(),content:'<div class="pannel-content"><div class="recom-content"></div></div>',height:177,top:210}},addCb:function(){if(this.isSimp==true){this.expand()}if($.isIE===6){$(".sui-dialog-xingzuo-pannel").css({top:"+="+$(window).scrollTop()})}},recomAddCb:function(a,d,c){var b=this;var e={cmd:"add",id:a.attr("data-id")};y(e,function(f){d&&d();c&&c();setTimeout(function(){b.refresh()},300)})},recomDelCb:function(d,a){var f=this;var b=d.attr("data-id");var c={cmd:"del",id:b};y(c,function(g){a&&a()});f.delItem(b);var e=$(".constel-head ."+z,q);if(e.length===0){this.blankFy()}},delItem:function(a,d){var f=$(".constel-head ."+z,q);var b=$(".mine-title-num span",q);if(f.length===0||(f.length===1&&!d)){$(".s-mblock-content",q).children().remove();b.html(0)}else{var e=$('.constel-content [data-pannel="'+a+'"]',q);var c=e.hasClass("cur-pannel");if(d&&c){this.switchPannel($('[data-daraggsort="'+d.cache[0]+'"]',q))}else{if(!d){if(!$("."+z,q).attr("data-daraggsort")){$('.constel-head [data-pannel="'+a+'"]').remove()}else{$('.constel-head [data-pannel="'+a+'"] .del-icon').trigger("click")}if(c){this.switchPannel($(".constel-head .constel-item:eq(0)",q))}}}b.html(parseInt(b.html())-1);e.remove()}},blankFy:function(){var a=this;var c='<div class="constell-blank"><div class="add-constell"></div></div>';a.contentDom.unbind("mousedown mouseup click").children().remove().end().addClass("block-blank").html(c);var b=$(".mine-title-num span",q);b.html(0);this.switchPannel(null);a.isBlank=true}};function o(){var a=this;a.draggsort=new r({componentWrap:$(".s-mblock-content .constel-head-content",q),identity:"mineconstel",dragsort:"."+z,dragHandle:".h",delAble:true,delSelector:".del-icon",containment:$(".s-mblock-content .constel-head",q),placeholder:false});var b={};a.draggsort.on("onAfterSort",function(d){qStr="";for(var e=0,g=d.cache,h=g.length;e<h;e++){var f=$(".constel-head-content",q).find('[data-daraggsort="'+g[e]+'"]');qStr+=(e===0?"":"_")+f.attr("data-pannel")}var c={cmd:"seq_in",ids:qStr};y(c)}).on("onSortDel",function(d){var e=d.delItem.data("pannel");var c={cmd:"del",id:e};y(c,function(){a.delItem(e,d)})})}function y(a,b){a=F.mix(a,{tabid:p});$.ajaxpost("/home/subscribe/submit/manoperation",a,function(c){b&&b(c)});s.fire("xingzuoOpration",{oprateMod:p,opration:a.cmd.replace("_","-"),curxingzuo:$(".constel-head .cur-pannel",q).attr("data-pannel")})}function u(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'}v.init=n});F.addLog("mantpl:xingzuo",{xingzuoOpration:"1100002001",xingzuoClick:"1100003001"});F.module("mantpl:lottery/countdown",function(u,s,n){var p=+new Date()-200,q=0;var o=s_session.portrait||"nologin";var r=function(f){var b=f+"";if(b.length<=3){return b}if(!/^(\+|-)?(\d+)(\.\d+)?$/.test(b)){return b}var d=RegExp.$1,e=RegExp.$2,a=RegExp.$3;var c=new RegExp();c.compile("(\\d)(\\d{3})(,|$)");while(c.test(e)){e=e.replace(c,"$1,$2$3")}return d+""+e+""+a};var t=function(d,c){d=d/100;var h="0 : 00 : 00.0";if(d<=0){return h}var a,e,b,f,g;a=Math.floor(d/864000);d=d%864000;e=Math.floor(d/36000);d=d%36000;b=Math.floor(d/600);d=d%600;f=Math.floor(d/10);d=d%10;g=d|0;e=e<10?("0"+e):e;b=b<10?("0"+b):b;f=f<10?("0"+f):f;return'<em class="num">'+a+"</em>天<em class='num'>"+e+"</em>小时<em class='num'>"+b+"</em>分<em class='num'>"+f+"</em>秒"};var x=function(f,c,d,b,e){var a=function(){var g=d-(+new Date()-p);if(g<0){e&&e();return}f.innerHTML=t(g,b);q=setTimeout(function(){a()},100)};a()};var m=function(b,f,d,e,h){if(!f){return}var a=f-window.sysTime*1000;if(a<=0){return}var c=Math.floor((d-a)/8);var g=function(i){if(i<=0||(d-i*c+a)<=0){h&&h();return}b.innerHTML=t(i*c+a,e);setTimeout(function(){g(i-1)},50)};g(7)};var v=function(b,d){var c=Math.ceil(d/8);var a=function(e){if(e>=d){b.innerHTML=r(d);return}else{b.innerHTML=r(e)}setTimeout(function(){a(e+c)},50)};a(c)};var w=function(a){p=+new Date()-200;var b=a;x(b[0],$(b).attr("data-time")*1000,(+$(b).attr("data-time")-window.sysTime)*1000,2,function(){setTimeout(function(){$(b).html("投注已截止")},200)})};s.init=w});F.module("mantpl:lottery/mine",function(A,v,N){var C=$("#s_xmancard_mine .s-block-lottery");var D=null;var O=A("superui:util/smDot");var x=A("superui:component/draggsort");var J=10;var z="lottery-item";var M=null;var K=0;var P=null;function G(a){I.prototype=$.extend({},a.prototype,I.prototype);D=new I();if($(".s-block-lottery .lottery-content")[0]){L();E()}N.fire("lotteryShow",{oprateMod:J,opration:$.trim($(".cur-pannel span").html())})}function L(a){$.ajaxget("/home/subscribe/data/manlotteryuserdata",function(d){var c="￥*****";var b=O.template(c,{varname:"it"});$(".s-lottery-user .num").html(b(d.data));if(K===0){H(d.data);w(d.data);D.carousel()}a&&a()})}function w(b){K=1;var a=$.extend({},b);delete a.balance;a.bd_bind=Boolean(b.bd_bind);$(".s-lottery-static-link").each(function(){$(this).attr("href",$(this).attr("href")+"&"+$.param(a))});$(".match-analyz a").each(function(){$(this).attr("href",$(this).attr("href")+"&"+$.param(a))})}function H(a){var b=$.parseJSON($.trim($("#data_links_user").html()));var c=$.extend({},a);delete c.balance;c.bd_bind=Boolean(a.bd_bind);$.each(b,function(d){if(this.linkcontent=="充值"){$(".user-charge-btn1").attr("href",this.linkurl+"&"+$.param(c))}if(this.linkcontent=="提现"){$(".user-charge-btn2").attr("href",this.linkurl+"&"+$.param(c))}if(this.linkcontent=="投注记录"){$(".user-record1").attr("href",this.linkurl+"&"+$.param(c))}if(this.linkcontent=="彩金卡兑现"){$(".user-record2").attr("href",this.linkurl+"&"+$.param(c))}M=a.balance})}var E=function(){$(".deadline-counter").each(function(){var a=this;N.use("lottery/countdown",function(b){b.init($(a))})})};function I(){this.constructor();this.id=J;this.hasSimp=false;this.blockDom=C;this.recomBlock="lottery";this.contentDom=$(".s-mblock-content",C);this.hasPannelBody=true;this.isBlank=!parseInt($(".mine-title-num span",C).html(),10);this.init();this.bindEvent()}I.prototype={bindEvent:function(){var a=this;C.delegate(".s-lottery-user .user-charge .user-charge-btn1","mouseover",function(b){$(this).addClass("s-opacity-background2")}).delegate(".s-lottery-user .user-charge .user-charge-btn1","mouseout",function(b){$(this).removeClass("s-opacity-background2")}).delegate(".s-lottery-user .user-charge .user-charge-btn2","mouseover",function(b){$(this).addClass("s-opacity-background2")}).delegate(".s-lottery-user .user-charge .user-charge-btn2","mouseout",function(b){$(this).removeClass("s-opacity-background2")}).delegate("."+z,"click",function(b){if(!!$(this).attr("data-daraggsort")&&!$(this).attr("CANCELDRAG")){return}a.switchPannel($(this))}).delegate(".add-lotteryl","click",function(b){a.add()}).delegate(".user-balance .text","click",function(b){if($(".user-balance .text").html()=="显示余额"){L(function(){$(".user-balance .text").html("隐藏余额");$(".user-balance .num").html("￥"+M)})}else{if($(".user-balance .text").html()=="隐藏余额"){$(".user-balance .text").html("显示余额");$(".user-balance .num").html("￥*****")}}N.fire("lotteryOpration",{oprateMod:J,opration:"balance"})}).delegate(".items-set-pagger","click",function(b){N.fire("lotteryOpration",{oprateMod:J,opration:"page"})}).delegate(".user-balance .refresh","click",function(b){$(".s-lottery-user .num").html("&nbsp;");if(!$(".s-lottery-user .num").hasClass("loading-gif")){$(".s-lottery-user .num").addClass("loading-gif")}L(function(){$(".s-lottery-user .num").removeClass("loading-gif");if($(".user-balance .text").html()=="隐藏余额"){$(".user-balance .num").html("￥"+M)}});N.fire("lotteryOpration",{oprateMod:J,opration:"refresh"})}).delegate(".type-curitem","click",function(b){$(this).closest(".type-selector").find(".type-items").toggle();N.fire("lotteryOpration",{oprateMod:J,opration:"type"})}).delegate(".type-item","click",function(d){var b=$(this).attr("data-type");var c=$(this).html();$(".result-pannel.cur-result-pannel",C).removeClass("cur-result-pannel");$('.result-pannel[data-type="'+b+'"]',C).removeClass("cur-result-pannel").addClass("cur-result-pannel");$(".date-selector.cur-date-selector",C).removeClass("cur-date-selector");$('.date-selector[data-type="'+b+'"]',C).removeClass("cur-date-selector").addClass("cur-date-selector");$(this).closest(".type-selector").find(".type-curitem").html(c).end().find(".type-items").hide()}).delegate(".date-curitem","click",function(b){$(this).closest(".date-selector").find(".date-items").toggle();N.fire("lotteryOpration",{oprateMod:J,opration:"date"})}).delegate(".date-item","click",function(e){var c=$(this).attr("data-date");var d=$(this).html();var b=$(this).parents("[data-type]").attr("data-type");$('.result-pannel[data-type="'+b+'"] .cur-date-pannel',C).removeClass("cur-date-pannel");$('.result-pannel[data-type="'+b+'"] .date-pannel[data-date="'+c+'"]',C).removeClass("cur-date-pannel").addClass("cur-date-pannel");$(this).closest(".date-selector").find(".date-curitem").html(d).end().find(".date-items").hide()}).delegate(".pagger-num","click",function(c){var g=$(this).parents(".items-set-pagger");var e=+g.attr("data-pall");var d=g.find(".cur-pagger");var f=d.attr("data-page");var b=0;if($(this).hasClass("pagger-up")){b=(+f+1);if(b>e){return}d.removeClass("cur-pagger");g.find('[data-page="'+b+'"]').removeClass("cur-pagger").addClass("cur-pagger")}else{if($(this).hasClass("pagger-down")){b=(+f-1);if(b<1){return}d.removeClass("cur-pagger");g.find('[data-page="'+b+'"]').removeClass("cur-pagger").addClass("cur-pagger")}else{b=$(this).attr("data-page");d.removeClass("cur-pagger");$(this).removeClass("cur-pagger").addClass("cur-pagger")}}$(this).parents(".date-pannel").find(".cur-set-pannel").removeClass("cur-set-pannel").end().find('.items-set[data-page="'+b+'"]').removeClass("cur-set-pannel").addClass("cur-set-pannel")}).delegate(".carousel","mouseenter mouseleave",function(b){if(b.type==="mouseenter"){a.toggleCarousel(true)}else{a.toggleCarousel(false)}}).delegate(".back-to-bet","click",function(b){}).delegate("a","click",function(b){if($(this).attr("data-name")){N.fire("lotteryOpration",{oprateMod:J,opration:$(this).attr("data-name"),url:$(this).attr("href")})}});$(document).on("mousedown",function(b){if(!$(b.target).parents(".date-selector")[0]){$(".date-items",C).hide()}if(!$(b.target).parents(".type-selector")[0]){$(".type-items",C).hide()}})},switchPannel:function(a){var d={cmd:"switch",tabname:""};if(a){$(".cur-pannel",C).removeClass("cur-pannel");var b=a.attr("data-pannel");a.addClass("cur-pannel");var c=$(".lottery-content [data-pannel="+b+"]",C);$("[data-src]",c).each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")});c.addClass("cur-pannel");d.tabname=b}B(d);N.fire("lotteryShow",{oprateMod:J,opration:b})},editCb:function(){var a=this;if(this.isSimp==true){this.expand()}if(!$("."+z,C).attr("data-daraggsort")){y.call(a)}else{$("."+z,C).removeAttr("CANCELDRAG")}},unEditCb:function(){$("."+z,C).attr("CANCELDRAG",1)},refreshCb:function(a){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(a.html).filter(".s-mblock-content");$(".s-block-container",C).append(this.contentDom);$(".mine-title-num span",C).html($(".lottery-head .lottery-item",C).length);this.isBlank=!parseInt($(".mine-title-num span",C).html(),10);K=0;if($(".s-block-lottery .lottery-content")[0]){L();E()}},pannelParam:function(){return{sugTpl:"",title:"添加彩票",itemTpl:Q(),content:'<div class="pannel-content"><div class="recom-content"></div></div>',height:177,top:210}},addCb:function(){if(this.isSimp==true){this.expand()}if($.isIE===6){$(".sui-dialog-lottery-pannel").css({top:"+="+$(window).scrollTop()})}},recomAddCb:function(c,a,e){var d=this;var b={cmd:"add",id:c.attr("data-id")};B(b,function(f){a&&a();e&&e();setTimeout(function(){d.refresh()},300)})},recomDelCb:function(c,e){var d=this;var a=c.attr("data-id");var b={cmd:"del",id:a};B(b,function(f){e&&e()});d.delItem(a)},delItem:function(f,e){var b=$(".lottery-head ."+z,C);if(b.length===0||(b.length===1&&!e)){this.blankFy()}else{var d=$('.lottery-content [data-pannel="'+f+'"]',C);var a=d.hasClass("cur-pannel");if(e&&a){this.switchPannel($('[data-daraggsort="'+e.cache[0]+'"]',C))}else{if(!e){if(!$("."+z,C).attr("data-daraggsort")){$('.lottery-head [data-pannel="'+f+'"]').remove()}else{$('.lottery-head [data-pannel="'+f+'"] .del-icon').trigger("click")}if(a){this.switchPannel($(".lottery-head .lottery-item:eq(0)",C))}}}var c=$(".mine-title-num span",C);c.html(parseInt(c.html())-1);d.remove()}},blankFy:function(){var a=this;var c='<div class="lotteryl-blank"><div class="add-lotteryl"></div></div>';a.contentDom.unbind("mousedown mouseup click").children().remove().end().addClass("block-blank").html(c);var b=$(".mine-title-num span",C);b.html(0);this.switchPannel(null);a.isBlank=true},domRun:function(b){var c=this;var d=P.length;var a=$(".s-lottery-user .carousel",C);c.curItem=b;a.find('[data-item="'+((c.curItem+1)%d)+'"]').stop().animate({left:0},500,function(){clearTimeout(c.carouselOut);c.carouselOut=setTimeout(function(){c.domRun(b+1)},5000)});a.find('[data-item="'+(c.curItem%d)+'"]').stop().animate({left:-a.width()},500,function(){$(this).css({left:a.width()})});c.curItem=(c.curItem+1)%d},carousel:function(){P=$.parseJSON($.trim($("#data_mine_lottery").html()));var c=this;var d='<&foreach $it as $key=>$oneItem&><a class="carousel-item" href="<&$oneItem.link&>" data-name="推广链接" target="_blank" data-item="<&$key&>"><&$oneItem.text&></a><&/foreach&>';var a=O.template(d,{varname:"it"});var b=$(".s-lottery-user .carousel",C);b.html(a(P));b.find('[data-item="0"]').css({left:0});setTimeout(function(){c.domRun(0)},2000)},toggleCarousel:function(a){var b=this;if(a){clearTimeout(b.carouselOut)}else{b.carouselOut=setTimeout(function(){b.domRun(b.curItem)},2000)}}};function y(){var a=this;a.draggsort=new x({componentWrap:$(".s-mblock-content .lottery-head-content",C),identity:"minelottery",dragsort:"."+z,dragHandle:".h",delAble:true,delSelector:".del-icon",containment:$(".s-mblock-content .lottery-head",C),placeholder:false});var b={};a.draggsort.on("onAfterSort",function(h){qStr="";for(var d=0,g=h.cache,f=g.length;d<f;d++){var c=$(".lottery-head-content",C).find('[data-daraggsort="'+g[d]+'"]');qStr+=(d===0?"":"_")+c.attr("data-pannel")}var e={cmd:"seq_in",ids:qStr};B(e)}).on("onSortDel",function(d){var e=d.delItem.data("pannel");var c={cmd:"del",id:e};B(c,function(){a.delItem(e,d)})})}function B(a,b){a=F.mix(a,{tabid:J});$.ajaxpost("/home/subscribe/submit/manoperation",a,function(c){b&&b(c)});N.fire("lotteryOpration",{oprateMod:J,opration:a.cmd.replace("_","-"),curlottery:$(".lottery-head .cur-pannel",C).attr("data-pannel")})}function Q(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'}v.init=G});F.addLog("mantpl:lottery",{lotteryOpration:"1100002001",lotteryShow:"1100003001"});F.module("mantpl:novel/mine",function(z,J,E){var H=$("#s_xmancard_mine .s-block-novel");var y="novel-item-content";var v='<span class="sp_sg_code">{{=it["name"]}}</span><span class="sp_sg_name">{{=it["author"]}}</span><span class="sp_sg_market">{{=it["genre"]}}</span><span class="sp_sg_hidden">{{=it["uri"]}}</span>';var A=$.parseJSON($.trim($("#s_minenovel_textarea").html())||"{}");var G=null;var B=20;var t=z("superui:component/dialog");var D=z("superui:util/dot"),w=[];function I(a){F.inherit(u,a);G=new u();J.novelMine=G}function u(){this.constructor();this.id=B;this.blockDom=H;this.recomBlock="novel";this.contentDom=$(".s-mblock-content",H);this.editExpand=true;this.isBlank=!!parseInt(A.isBlank,10);this.init();this.hasPannelBody=true;this.bindEvent();this.addExShow=true}u.prototype={bindEvent:function(){var a=this;H.delegate(".novel-item","click",function(b){var c=$(this).parent();if(c.attr("canceldrag")=="1"||!c.attr("data-daraggsort")){E.fire("novelClick",{oprateMod:B,opration:"click",url:$(".novel-pic a",this).attr("href")})}if($(this).closest(".edting-block").length){b.preventDefault()}}).delegate(".add-novel","click",function(b){a.add()}).on("mouseenter mouseleave",".novel-item",function(b){if($.isIE===6){if(b.type==="mouseenter"){$(this).addClass("hover")}else{$(this).removeClass("hover")}}});E.listen("mancard:skeleton/presenter","switchCard",function(b){if(b.toCard=="100"&&($(".s-xmancard-novel").attr("data-subChange")==1)){$(".s-xmancard-novel").attr("data-subChange",0);a.refresh()}})},editCb:function(){if(this.isSimp===true){this.expand()}if(!this.sorted){M.call(this,this.draggFetch)}else{$("."+y,H).removeAttr("CANCELDRAG")}},draggFetch:function(a){a=F.mix(a,{tabid:G.id});$.ajaxpost("/home/subscribe/submit/manoperation",a,function(b){E.fire("novelOpration",{oprateMod:B,opration:a.cmd.replace("_","-")})})},unEditCb:function(){var a=this;$("."+y,H).attr("CANCELDRAG","1");if($("."+y,H).length===0){a.refresh();a.blankFy()}},refreshCb:function(a){this.contentDom.unbind("mousedown mouseup click");this.sorted=false;this.contentDom.remove();this.contentDom=$(a.html).filter(".s-mblock-content");H.find(".s-block-container").append(this.contentDom);H.find(".mine-title-num span").html(this.contentDom.find(".novel-item-content").length);if(this.contentDom.find(".novel-item-content").length>0){this.isBlank=false}else{this.isBlank=true}if(H.attr("data-status")=="edting"){this.edit()}},addItem:function(a){var d=['<div class="novel-item-content" data-uri="{{=it.uri}}">','<div class="novel-item">','<div class="del-icon"></div>','<div class="novel-pic">','<a href="{{=it.url}}" target="_blank" hidefocus>','<img src="{{=$.url.escapeSSL(it.img)}}" />',"</a>","</div>",'<div class="novel-info">','<p class="name"><a href="{{=it.url}}" title="{{=it.name}}" target="_blank">{{=it.name}}</a></p>','<p class="author">作者：{{=it.author}}</p>','<p class="up">更新：<a href="{{=it.up.url}}" title="{{=it.up.name}}" target="_blank" title="{{=it.up.name}}">{{=it.up.name}}</a></p>',"</div>","</div>","</div>"].join(""),e=D.template(d),c,b,f;if(a.errNo==0){this.serialize();c=e(a.data);b=H.find(".s-mblock-content");b.find(".novel-blank").remove();b.prepend(c);E.fire("novelsubscribe",{id:a.data.uri})}},serialize:function(){var d=$(".novel-item-content",H),a,c=0,f,e=w.length,b=[];if(e){for(;c<e;c++){f=w[c];a=d.eq(f);a.removeAttr("data-daraggsort canceldrag style");b.push(a)}$(".s-mblock-content",H).empty().append(b);w=[];this.refresh()}},pannelParam:function(){this.sugWidth=681;var a=x();return{sugTpl:a,title:"添加小说",itemTpl:L(),top:80,height:508}},addCb:function(b){var a=this;if($.isIE===6){$(".sui-dialog-novel-pannel").css({top:"+="+$(window).scrollTop()})}if(a.isSimp===true){a.expand()}if(!b){return}C.call(a);var c=a.AddPannel.componentWrap.find(".sui-dialog-novel-pannel .sug-link");a.AddPannel.body.delegate(".sug-button","click",function(d){a.addAction(c)}).delegate(".sug-link","keydown",function(d){if(d.keyCode==8){c.removeAttr("data-uri")}}).delegate(".sug-link","click",function(d){if(a.sugInstance.cache){a.sugInstance.show()}});a.AddPannel.on("onhide",function(){c.val("").data("uri","");a.sugInstance.cache=null})},addAction:function(a){var b=this;if(a&&a.val()!=""){if(!!a.attr("data-uri")){b.recomAddCb(a,function(){b.SuccessTips.show();a.val("").data("uri","")})}else{if(b.sugInstance.resdata&&b.sugInstance.resdata.length>0){b.recomAddCb(null,function(){b.SuccessTips.show();a.val("").data("uri","")},function(){},b.sugInstance.resdata[0].uri)}else{b.ErroTips.show()}}a.val("").attr("data-uri","");b.sugInstance.cache=null}},recomAddCb:function(a,e,d,b){var c=this;var f={cmd:"add",id:a?a.attr("data-uri"):b};K.call(this,f,function(g){if(f.cmd=="add"){if(!a){a=c.sugInstance.input}if(g.errNo=="501"&&f.cmd=="add"){F.use("superui:component/tips",function(h){new h({target:a,identity:"navsugalert",componentWrap:c.AddPannel.body,content:"添加超过上限！",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"}).show()});d&&d();return}else{if(g.errNo=="500"&&f.cmd=="add"){F.use("superui:component/tips",function(h){new h({target:a,identity:"navsugerror",componentWrap:c.AddPannel.body,content:"您已添加过该小说！",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"}).show()});d&&d();return}else{if(g.errNo!="0"){F.use("superui:component/tips",function(h){new h({target:a,identity:"novelsugfail",componentWrap:c.AddPannel.body,content:"添加失败",timing:2000,model:"left",icons:"error",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"}).show()});d&&d();return}}}}e&&e();d&&d();setTimeout(function(){c.addItem(g)},300)})},recomDelCb:function(a,c){var b=this;var d=a.attr("data-uri");var e={cmd:"del",id:d};K.call(this,e,function(f){c&&c()});b.delItem(d)},delItem:function(a,c){var b=$(".novel-item-content",H);if(b.length===0||(b.length===1)){this.blankFy()}else{b.filter('[data-uri="'+a+'"]').remove()}},blankFy:function(){var a=this;var c='<div class="novel-blank"><div class="add-novel"></div></div>';a.contentDom.unbind("mousedown mouseup click").addClass("block-blank").html(c);var b=$(".mine-title-num span",H);b.html(0);a.isBlank=true}};function L(){var a="";return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-uri="{{=item.uri}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'}function x(){var a='<div class="novel-sug-wrap"><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-button">添加小说</div></div>';return a}function C(){var a=this;F.use("superui:component/suggestion",function(b){a.sugInstance=new b({componentWrap:$(".sug-content",a.AddPannel.body),identity:"novelAddPannel",input:$(".sug-link",a.AddPannel.body),width:681,url:"//www.baidu.com/sugrec?wd={wd}&prod=open_novel&json=1",template:v,autoFill:null,focusShow:false})});F.use("superui:component/tips",function(b){a.ErroTips=new b({target:$(".sug-link",a.AddPannel.body),identity:"novelsugerror",content:"请输入有效信息",timing:2000,model:"left",arrowDown:false,icons:"error",theme:"white",autoShow:false});a.SuccessTips=new b({target:$(".sug-link",a.AddPannel.body),identity:"novelsugerror",componentWrap:a.AddPannel.body,content:"添加成功",timing:2000,model:"left",arrowDown:false,icons:"success",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"})});F.use("superui:component/placeholder",function(b){a.PlaceTips=new b({componentWrap:$(".sug-link-wrap",a.AddPannel.body),top:1,left:30,identity:"mineAddSug",target:$(".sug-link",a.AddPannel.body),holderText:"输入小说名称或作者笔名",height:30,lineheight:30})});a.sugInstance.on("onSelect",function(b){$(".sug-link",a.AddPannel.body).val(b.name).attr("data-uri",b.uri)})}function K(c,b){var a=this;c=F.mix(c,{tabid:B});$.ajaxpost("/home/subscribe/submit/manoperation",c,function(d){b&&b(d);if(parseInt(d.errNo)===0){if(c.cmd==="add"){var e=$(".mine-title-num span",H);e.html(parseInt(e.html())+1);a.isBlank=false}else{if(c.cmd==="del"){var e=$(".mine-title-num span",H);if(parseInt(e.html())-1>=0){e.html(parseInt(e.html())-1)}}}}E.fire("novelOpration",{oprateMod:B,opration:c.cmd.replace("_","-")})})}function M(c){var a=this;var b=a.sortFy({identity:"minenovel",dragsort:"."+y,delSelector:".del-icon",dataIdenti:"data-uri",componentWrap:a.contentDom,containment:a.contentDom});w=[];a.sorted=true;var d={};var e="";b.drags.each(function(){var f=$(this).attr("data-daraggsort");d[f]=$(this).data("uri");w.push(f)});b.on("onAfterSort",function(h){e="";var j=H.find(".s-mblock-content");for(var l=0,g=h.cache,f=g.length;l<f;l++){var k=j.find('[data-daraggsort="'+g[l]+'"]');e+=k.attr("data-uri")+"_"}e=e.substr(0,e.length-1);var i={cmd:"seq_in",rscids:e};c&&c.call(a,i);w=h.cache}).on("onSortDel",function(i){var g={cmd:"del",id:i.delItem.data("uri")};c&&c.call(a,g);var f=$(".mine-title-num span",H),h=$(".novel-item-content",H);if(parseInt(f.html())-1>=0){f.html(parseInt(f.html(),10)-1)}if(h.length==0||h.length===1){w=[]}E.fire("novelunsubscribe",{id:i.delItem.data("uri")})})}J.init=I;J.novelMine=G});F.addLog("mantpl:novel",{novelOpration:"1100002001",novelClick:"1100003001"});F.module("mantpl:mine/cards_manager",function(s,p,o){var x=s("superui:util/smDot");var q=s("superui:component/dialog");var u=s("superui:component/draggselect");var w=x.template(['<div class="s-minesetting" id="s_mine_manager" data-id="99">','<div class="s-minesetting-wrap clearfix">','<div class="s-minesetting-left">',"<h3>已关注</h3>",'<div class="s-minesetting-content">',"<&foreach $it.tplOnSet as $selected&>","<&if $selected.id&>",'<div class="s-mod-item <& if $selected.id == "100"&>s_mod_myitem<&/if&>"<& if $selected.id == "100"&> canceldrag="2"<&/if&> id="s_mineitem_<&$selected.id&>" data-id="<&$selected.id&>" data-imgname="<&$selected.imgname&>" data-name="<&$selected.name&>">','<div class="s-mod-icon">',"</div>",'<div class="s-mod-title" <&if $selected.id == "100"&>canceldrag="2"<&/if&>>',"<&$selected.name&>","</div>","</div>","<&/if&>","<&/foreach&>","</div>",'<div class="nomore-tips-left">拖动到这里可以继续关注</div>',"</div>",'<div class="s-minesetting-right">',"<h3>未关注</h3>",'<div class="s-minesetting-content">',"<&foreach $it.tplOffSet as $unselected&>","<&if $unselected.id&>",'<div class="s-mod-item" id="s_mineitem_<&$unselected.id&>" data-id="<&$unselected.id&>" data-imgname="<&$unselected.imgname&>" data-name="<&$unselected.name&>">','<div class="s-mod-icon">',"</div>",'<div class="s-mod-title">',"<&$unselected.name&>","</div>","</div>","<&/if&>","<&/foreach&>","</div>",'<div class="nomore-tips-right">拖动到这里可以取消关注</div>',"</div>","</div>",'<div class="setting-arrow setting-arrow-bottom">',"<em></em>","</div>","</div>"].join(""),{varname:"it"});var A=".s-minesetting-left .s-minesetting-content";var r=".s-minesetting-right .s-minesetting-content";var y="s-mod-item";var t="."+y;var z=31;var v=144;function B(){this.manageTpl="";this.topDom=$("#s_xmancard_mine");this.initManager=false}B.prototype={constructor:B,init:function(d,a,c,b){this.mainData=d;this.enterBtn=a;this.hideCb=c;this.$topDom=b;this.initManager=true},renderView:function(){var a=this;a.dialog=new q({identity:"minesetting",width:653,content:w(this.mainData),position:function(){return{bottom:z,left:25}},theme:"minesetting",autoShow:true,hasMask:false,hasClose:true,componentWrap:a.topDom.find(".tips-manager-area"),hackToTop:false});a.dialog.on("onHide",function(){a.showed=false;a.enterBtn.removeClass("edting-btn-text");a.hideCb&&a.hideCb()});a.bindEvent()},bindEvent:function(){this.dialog.body.on("mouseenter mouseleave",".s-mod-item",function(a){if(a.type==="mouseenter"){$(this).removeClass("mod-hover").addClass("mod-hover")}else{$(this).removeClass("mod-hover")}});this.sortFy()},sortFy:function(){var b=this;var a=b.dialog;var c;b.draggselect=new u({identity:"minesetting",containment:a.body,selected:a.body.find(A),unselected:a.body.find(r),dragsort:t,cansort:false});b.judgeEmpty();b.draggselect.on("onBeforeSelectSwap",function(){b.draggselect.selected.parentoffset=$(".s-minesetting-left .s-minesetting-content").offset();b.draggselect.unselected.parentoffset=$(".s-minesetting-right .s-minesetting-content").offset()}).on("onSelectSwap",function(d){d.dragItem&&d.dragItem.removeClass("mod-hover");b.judgeEmpty()}).on("onBeforeSelect",function(d){c=d.dragItem;c.css("zoom","0")}).on("onAfterSelect",function(d){setTimeout(function(){c.css("zoom","1")},50)})},judgeEmpty:function(){var b=this;var a=b.dialog;if(b.draggselect.selected.cache.length===0){$(".nomore-tips-left",a.body).show()}else{$(".nomore-tips-left",a.body).hide()}if(b.draggselect.unselected.cache.length===0){$(".nomore-tips-right",a.body).show()}else{$(".nomore-tips-right",a.body).hide()}},toggle:function(){var a=this;if(!a.showed){a.show()}else{a.hide()}},show:function(){var a=this;a.computePos();a.dialog.show();if(a.shouldReflow){a.reflow()}a.showed=true;a.enterBtn.removeClass("edting-btn-text").addClass("edting-btn-text")},hide:function(){var a=this;a.dialog.hide();a.showed=false;a.enterBtn.removeClass("edting-btn-text")},destroy:function(){var a=this;if(a.initManager){a.showed=false;a.initManager=false;a.dialog.window.remove();a.dialog.mask&&a.dialog.mask.remove();a.dialog=null;return true}return false},computePos:function(){var b=this;var a=b.enterBtn.offset().top-b.$topDom.offset().top;if(a<v){b.dialog.window.css({bottom:"",top:z});b.dialog.window.find(".setting-arrow").removeClass("setting-arrow-bottom").addClass("setting-arrow-top")}else{b.dialog.window.css({bottom:z,top:""});b.dialog.window.find(".setting-arrow").removeClass("setting-arrow-top").addClass("setting-arrow-bottom")}},reflow:function(){var a=this;a.shouldReflow=true;a.draggselect.selected.collapse();a.draggselect.selected.sort(false,true)}};return new B()});F.addLog("mantpl:mine/view",{manageOpt:"1100001002"});F.module("mantpl:mine/view",function(l,k,t){var s=l("superui:util/smDot");var m='<div class="recom-content"><&foreach $cards as $oneItem&><&if $oneItem.id&><div class="recom-item" data-id="<&$oneItem.id&>"><span class="recom-icon"></span><span class="recom-text"><&$oneItem.name&></span></div><&/if&><&/foreach&></div>';var r=l("superui:component/tips");var n=s.template(m,{varname:"cards"});function o(){this.$topDom=$("#s_xmancard_mine");$("#s_xmancard_mine .s-mine-wrapper .s-code-blocks:first-child").find(".set-totop").css("color","#999")}o.prototype={showDialog:function(c,a){var b=this;if(!!b.addPannel){b.addPannel.body.html(n(c.tplOffSet));b.addPannel.show();return}F.use("superui:component/dialog",function(e){b.addPannel=new e({identity:"mineblank",content:n(c.tplOffSet),hasClose:true,theme:"mine-blank-pannel sui-dialog-mine-pannel",autoShow:true,height:188,width:491,top:"50%",title:"添加关注"});if($.isIE===6){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())}var d=false;b.addPannel.window.on("click",".recom-item",function(f){if(d){return}d=true;var h=$(this);var g=h.attr("data-id");var i=!h.hasClass("item-added");if(i){h.addClass("item-added");p.call(b,"addTips",h,{flashHide:true,wrap:b.addPannel.window})}else{h.removeClass("item-added");p.call(b,"delTips",h,{content:"取消成功！",flashHide:true,wrap:b.addPannel.window})}setTimeout(function(){d=false},600);a&&a(g,i)}).on("mouseenter",".recom-item",function(f){var g=$(this);if(g.hasClass("item-added")){p.call(b,"hoverTips",g,{content:"已添加，点击取消",flashHide:true,icons:"",wrap:b.addPannel.window})}});b.addPannel.on("onHide",function(){t.fire("manageOpt",{opType:"layerclose",opVal:-1})})})},addBlock:function(i,c,d,g){var h=this;if(h.$topDom.find(".s-all-blank")[0]){h.$topDom.find(".s-all-blank").hide()}var e=null;if(!(e=h.$topDom.find(".s-block-"+c))[0]&&i){var f=d.tplOnSet.length;var b=false;while(f--){var a=null;if(b&&(a=$(".s-block-"+d.tplOnSet[f].ename,h.$topDom))[0]){break}if(d.tplOnSet[f].id===g){b=true}}if(f===-1){h.$topDom.find(".s-mine-wrapper").prepend(q(i.html,c))}else{a.after(q(i.html,c))}}else{h.$topDom.find(".s-mine-wrapper").append(e);e.show()}if($.isIE===6){setTimeout(function(){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())},200)}},delBlock:function(b,a){$(".s-block-"+b,this.$topDom).hide();if($.isIE===6){setTimeout(function(){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())},200)}}};function q(a,b){return'<div class="s-code-blocks s-block-'+b+'" data-block="'+b+'" data-status="normal"><div class="s-block-container">'+a+"</div></div>"}function p(a,c,d){var b=this;if(!b.hideTout){b.hideTout={}}if(!b[a]){b[a]=new r(F.mix({target:c,identity:a+"manage",content:d.content||"添加成功",arrowUp:false,icons:"success",arrowLeft:"center",align:"center",autoShow:true,componentWrap:d.wrap},d))}else{if(d.flashHide){clearTimeout(b.hideTout[a])}b[a].hide();b[a].target=c;b[a].show()}if(d.flashHide){b.hideTout[a]=setTimeout(function(){b[a].hide()},1000)}}return new o()});F.module("mantpl:mine/model",function(r,p,n){var m=$.parseJSON($.trim($("#s_minetpl_textarea").html()));var s=100;var l={};function t(){}var v={sort:function(a,c){var e=[];for(var d=0,b=m.tplOffSet.length;d<b;d++){e[d]=m.tplOffSet[d].id}$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"seq_in",idsOn:c.ids.join("_"),idsOff:e.join("_"),tabid:s},function(f){a&&a(f)});for(var d=0,b=c.ids.length;d<b;d++){l[c.ids[d]]=d}m.tplOnSet.sort(function(g,f){return(l[g.id]-l[f.id])})},top:function(b,c){var a=m.tplOnSet.length;while(a--){if(+m.tplOnSet[a].id===+c.id){var d=m.tplOnSet.splice(a,1);m.tplOnSet.unshift(d[0]);break}}}};var u={tplData:function(b,a){b&&b(m);return m},mineHtml:function(b,a){$.ajaxget("/home/subscribe/data/mancardmine?id="+a.id,function(c){b&&b(c)})}};var q={card:function(g,c){var a=m.tplOffSet.length;var e=[];var f=[];var d=c.id;while(a--){if(m.tplOffSet[a].id===d){m.tplOnSet.push(m.tplOffSet[a]);m.tplOffSet.splice(a,1)}else{f.unshift(m.tplOffSet[a].id)}}a=m.tplOnSet.length;while(a--){e.unshift(m.tplOnSet[a].id)}var b={idsOn:e,idsOff:f};$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"add",idsOn:e.join("_"),idsOff:f.join("_"),id:d,tabid:s},function(h){g&&g(h)});return b}};var o={card:function(a,c){var b=m.tplOnSet.length;var e=[];var f=[];var d=c.id;while(b--){if(m.tplOnSet[b].id===d){m.tplOffSet.push(m.tplOnSet[b]);m.tplOnSet.splice(b,1)}else{e.unshift(m.tplOnSet[b].id)}}b=m.tplOffSet.length;while(b--){f.unshift(m.tplOffSet[b].id)}$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"del",idsOn:e.join("_"),idsOff:f.join("_"),id:d,tabid:s},function(g){a&&a(g)})}};t.prototype={get:function(a,b,c){return(u[a]&&u[a](b,c))||false},set:function(a,b,c){return(v[a]&&v[a](b,c))||false},add:function(a,b,c){return(q[a]&&q[a](b,c))||false},del:function(a,b,c){return(o[a]&&o[a](b,c))||false}};return new t()});F.module("mantpl:mine/amine",function(t,v,L){var x=$("#s_xmancard_mine");var J=t("superui:util/dot");var M=t("superui:component/suggestion");var y=t("superui:component/placeholder");var w=t("superui:component/draggsort");var E=t("superui:component/tips");var u={NORMAL:"normal",EDITING:"edting",EXPENDED:"expand"};var G={EDITING:"edting-block"};var H=".s-setbar";function I(){this.reqParam={addParam:null,editParam:null,expandParam:null,refreshParam:null};this.id=null;this.blockDom=null;this.__toolDom=null;this.blockName="mine";this.Suggestion=M;this.PlaceHolder=y;this.Tips=E;this.Dot=J;this.Draggsort=w}I.prototype={constructor:I,init:function(){this.blockName=this.blockDom&&this.blockDom.attr("data-block");this.__toolDom=this.blockDom.find(H);this.blockDom.attr("data-status",u.NORMAL);this.contentDom=this.contentDom||this.blockDom.find(".s-mblock-content");this.hasAdd=true;this.isSimp=!!parseInt(this.blockDom.find(".s-setbar").attr("data-issimp"));this.__bindEvent();this.isBlank=+$(".mine-title-num span",this.blockDom).html()===0?true:false;this.buttonFy()},setAttr:function(a){$.extend(this,a)},trimDom:function(c){if(c[0]){var a=c[0].childNodes;for(var b in a){if(a[b]&&a[b].nodeType===3){c[0].removeChild(a[b])}}}},__bindEvent:function(){var a=this;x.delegate(".s-block-"+a.blockName,"mouseenter mouseleave",function(b){if(b.type=="mouseenter"){if(a.blockDom.attr("data-status")===u.NORMAL){a.__toolDom.show();a.buttonFy()}}else{a.__toolDom.hide()}}).delegate(".s-block-"+a.blockName+" .set-btn","click",function(b){var c=$(this).attr("data-cmd");a[c]&&a[c]();L.fire("usetool",{id:"5138100001",oprateMod:a.id,opType:c});b.stopPropagation()}).delegate(".s-block-"+a.blockName+" .toggle-btn","click",function(b){var c=$(this).attr("data-cmd");a[c]&&a[c](null,true);L.fire("usetool",{id:"5138100001",oprateMod:a.id,opType:c})}).delegate(".s-block-"+a.blockName+" .s-mblock-title","click",function(b){if(!a.blockDom.hasClass("edting-block")){if(a.blockDom.hasClass("s-mblock-up")){L.fire("usetool",{oprateMod:a.id,opType:"expand"});a.expand()}else{L.fire("usetool",{oprateMod:a.id,opType:"unexpand"});a.unexpand()}L.fire("cardresize")}}).delegate(H,"click",function(b){b.stopPropagation()});L.listen("mancard:subscribe/subscribe","refresh",function(b){if(b.tabid==a.id||b.param.type==a.blockDom.attr("data-block")){setTimeout(function(){if(a.addExShow){a.exshow(null,true)}else{a.refresh()}},600)}})},buttonFy:function(){var b=this;if(b.isBlank){b.__toolDom.find(".set-edit").hide();b.__toolDom.find(".set-expand").hide();b.__toolDom.find(".set-refresh").hide();b.__toolDom.find(".edit-class").css({display:"none"})}else{b.__toolDom.find(".set-edit").show();b.__toolDom.find(".set-expand").show();b.__toolDom.find(".set-refresh").show();var a=($.isIE===6||$.isIE===7)?"inline":"inline-block";b.__toolDom.find(".edit-class").css({display:a})}if(b.hasAdd){b.__toolDom.find(".set-add").show()}else{b.__toolDom.find(".set-add").hide()}},add:function(){var a=this;var b=a.outAddPannel();var c=false;this.addCb&&this.addCb(b);if(!b){return}a.AddPannel.componentWrap.find(".sui-dialog-"+a.blockName+"-pannel").delegate(".recom-item","mouseenter mouseleave mouseup",function(d){if(d.type==="mouseup"){if(c){return}if($(this).hasClass("item-added")){c=true;var e=this;a.recomDelCb&&a.recomDelCb($(this),function(){$(e).removeClass("item-added");A.call(a,"delTips",$(e),{content:"取消成功！",flashHide:true});setTimeout(function(){c=false},800)})}else{c=true;var e=this;a.recomAddCb&&a.recomAddCb($(e),function(){$(e).addClass("item-added");A.call(a,"addTips",$(e),{flashHide:true})},function(){setTimeout(function(){c=false},800)})}}else{if(d.type==="mouseenter"){if($(this).hasClass("item-added")){A.call(a,"hoverTips",$(this),{content:"已添加，点击取消",flashHide:false,icons:""})}else{if($.isIE===6){$(this).addClass("recom-hover")}}}else{if(d.type==="mouseleave"){if($(this).hasClass("item-added")){a.hoverTips&&a.hoverTips.hide()}else{if($.isIE===6){$(this).removeClass("recom-hover")}}}}}})},totop:function(){var c=this;var a="";if(c.blockDom.is(".s-code-blocks:first")){return}x.find(".s-mine-wrapper").prepend(c.blockDom);$(".set-totop").css("color","#333");$("#s_xmancard_mine .s-mine-wrapper .s-code-blocks:first-child").find(".set-totop").css("color","#999");c.__toolDom.stop().fadeOut(200);var b=[];$(".s-code-blocks:visible",x).each(function(){b.push($(this).attr("data-block"))});L.fire("totop",{id:c.id});K(c.id,{cmd:"totop",tabid:100,topid:b.join("_")})},outAddPannel:function(){var a=this;var b=a.pannelParam&&a.pannelParam();if(a.AddPannel){a.AddPannel.show();a.AddPannel.body.find(".recom-content").html('<img src="'+s_domain.staticUrl+'static/mantpl/img/mine/loading_72b1da62.gif" class="loading-img"/>');if(a.hasPannelBody){C(a.recomBlock,function(c){a.AddPannel.body.find(".recom-content").html(z(c.data,b.itemTpl))})}return false}F.use("superui:component/dialog",function(c){a.AddPannel=new c({identity:"changeDir",content:typeof b.content=="undefined"?D(b):b.content,hasClose:true,theme:a.blockName+"-pannel sui-dialog-mine-pannel",autoShow:true,height:b.height,width:841,top:b.top||308,title:b.title});if($.isIE===6){$("#sui-dialog-mask").height($(document.body).height())}});if(a.hasPannelBody){C(a.recomBlock,function(c){a.AddPannel.body.find(".recom-content").html(z(c.data,b.itemTpl))})}return true},edit:function(){var a=this;a.blockDom.attr("data-status",u.EDITING).addClass(G.EDITING);a.__toolDom.hide();if(!a.editDom){a.editDom=$(".edit-tool",a.blockDom)}a.editDom.show();a.editCb&&a.editCb();$("#s_mancard_main .s-more-bar").trigger("click")},unedit:function(){var a=this;a.blockDom.attr("data-status",u.NORMAL).removeClass(G.EDITING);a.__toolDom.show();a.editDom.hide();a.unEditCb&&a.unEditCb();a.buttonFy()},unexpand:function(b){var a=this;a.isSimp=true;a.unexshow(b,false);K(a.id,{cmd:"setSimp",isSimp:"1",tabid:a.id});a.reqParam=$.extend({},a.reqParam);a.reqParam.refreshParam=a.reqParam.refreshParam||{};a.reqParam.refreshParam.isSimp=1},expand:function(b,a){var c=this;c.isSimp=false;K(c.id,{cmd:"setSimp",isSimp:"0",tabid:c.id});c.exshow(b,false);c.reqParam=$.extend({},c.reqParam);c.reqParam.refreshParam=c.reqParam.refreshParam||{};c.reqParam.refreshParam.isSimp=0},unexshow:function(b,a){this.blockDom.removeClass("s-mblock-up").addClass("s-mblock-up");b&&b()},exshow:function(b,a){this.blockDom.removeClass("s-mblock-up");b&&b()},refresh:function(b){var a=this;a.loading(true);B(a.id,function(c){a.loading(false);if(b){b.call(a,c)}else{a.refreshCb&&a.refreshCb.call(a,c)}},a.reqParam&&a.reqParam.refreshParam)},sortFy:function(e,d){var b=this;var a={componentWrap:$(".s-mblock-content",b.topDom),dragHandle:".h",delAble:true,containment:$(".s-mblock-content",b.blockDom),placeholder:false,preventShake:true};$.extend(a,e);var c=new w(a);return(this.draggsort=c)},loading:function(b){var a=this;if(b){a.blockDom.addClass("virtual");if(!a.loadingDom){a.loadingDom=$('<div class="block-loading"></div>');a.blockDom.append(a.loadingDom)}a.loadingDom.show()}else{a.blockDom.removeClass("virtual");a.loadingDom.hide()}}};function A(b,d,a){var c=this;if(!c[b]){c[b]=new E(F.mix({target:d,identity:b+"manage",content:a.content||"添加成功",arrowUp:false,icons:"success",arrowLeft:"center",align:"left",autoShow:true},a))}else{if(a.flashHide){clearTimeout(c.hideTout)}c[b].hide();c[b].target=d;c[b].show()}if(a.flashHide){c.hideTout=setTimeout(function(){c[b].hide()},1000)}}function D(b){var a='<div class="pannel-content"><div class="sug-content">#{sugTpl}</div><div class="recom-content"><img src="#{staticUrl}static/mantpl/img/mine/loading_72b1da62.gif" class="loading-img"/></div></div>';return $.formatString(a,{staticUrl:window.s_domain.staticUrl,sugTpl:b.sugTpl})}function z(a,c){var b='{{~it.dirs :oneDir:index}}<div class="one-class"><div class="class-title">{{=oneDir.dirName}}</div><div class="class-recoms">{{~oneDir.items :item:i}}#{itemTpl}{{~}}</div></div>{{~}}';return J.compile($.formatString(b,{itemTpl:c}))({dirs:a})}function C(c,b){var a=(c==="nplus")?"/home/"+c+"/data/manrecom":"/home/subscribe/data/manrecom"+c;$.ajaxget(a,function(d){b&&b(d)})}function B(a,d,b){var c="";c=(b&&"&"+$.param(b))||"";$.ajaxget("/home/subscribe/data/mancardmine?id="+a+c,function(e){d&&d(e)})}function K(c,a,b){$.ajaxpost("/home/subscribe/submit/manoperation",a||{},function(d){b&&b()})}return I});F.addLog("mantpl:mine",{usetool:"1100001001"});F.addLog("mantpl:mine/presenter",{manageOpt:"1100001002"});F.module("mantpl:mine/presenter",function(aa,J,H){var U=aa("mantpl:mine/view");var P=aa("mantpl:mine/amine");var G=aa("mantpl:mine/model");var I=aa("mantpl:mine/cards_manager");var R=U.$topDom;var W=G.get("tplData");var T=W.tplOnSet;var Z={};var E={};var Y=100;function M(){V();S();D();N()}function N(){$("#s_content_"+Y).attr("data-waterpara","noload=1;")}function D(){if(R.parents(".s-content").attr("data-loaded")==="1"){Q()}}function S(){for(var c=0,a=T.length;c<a;c++){var b="mantpl:"+T[c].ename+"/mine";F.call(b,"init",P)}var d=W.tplOffSet.concat(W.tplOnSet);for(c=0,a=d.length;c<a;c++){Z[+d[c].id]=d[c].ename}c=W.tplOnSet.length;while(c--){E[W.tplOnSet[c].id]=true}}function V(){R.on("click",".blank-add-btn",function(a){U.showDialog(W,B);H.fire("manageOpt",{opType:"blankadd",opVal:-1})}).on("click",".tips-manager-btn",function(b){var a=this;if(!I.initManager){I.init(W,$(a),A,R);I.renderView();O(I.draggselect)}I.toggle();H.fire("manageOpt",{opType:I.showed?"manageshow":"managehide",opVal:-1});b.stopPropagation()}).on("click",".manager-notify",function(a){a.stopPropagation()}).on("mouseenter",function(a){if(!I.initManager){F.call("mantpl:mine/cards_manager","")}});$(document).on("mousedown",function(a){if(I.showed&&!$(a.target).closest(".sui-dialog-minesetting")[0]&&!$(a.target).closest(".tips-manager-btn")[0]){I.hide();H.fire("manageOpt",{opType:"managehide",opVal:-1})}});H.listen("mancard:skeleton/card","cardloaded",function(a){if(a.cardId==100){Q()}});H.listen("mantpl:mine/amine","totop",function(a){G.set("top",null,{id:a.id});I.destroy()});H.listen("mancard:subscribe/subscribe","refresh",function(b){var a=W.tplOffSet.length;while(a--){if(+W.tplOffSet[a].id===+b.tabid){K(b.tabid);I.destroy()}}})}function X(){R.find(".s-mine-wrapper .s-all-blank").show();I.destroy()}function A(){var a=W.tplOnSet.length;if(a===0){R.removeClass("s-mine-blank").addClass("s-mine-blank")}for(var b=0;b<a;b++){K(W.tplOnSet[b].id,true)}a=W.tplOffSet.length;for(var b=0;b<a;b++){C(W.tplOffSet[b].id,true)}}function B(b,a){if(a){K(b);H.fire("manageOpt",{opType:"layeradd",opVal:b})}else{C(b);H.fire("manageOpt",{opType:"layerdel",opVal:b})}}function K(c,a){var b="mantpl:"+Z[c]+"/mine";!a&&G.add("card",null,{id:c});if(!E[c]){G.get("mineHtml",function(d){U.addBlock(d,Z[c],W,c);F.call(b,"init",P)},{id:c});E[c]=true}else{if($(".s-block-"+Z[c]+" .edit-tool").css("display")=="block"){$(".s-block-"+Z[c]+" .edit-tool .edit-comp").trigger("click")}U.addBlock(null,Z[c],W,c)}R.removeClass("s-mine-blank")}function C(b,a){!a&&G.del("card",null,{id:b});U.delBlock(Z[b],b);if(W.tplOnSet.length===0){R.removeClass("s-mine-blank").addClass("s-mine-blank").find(".s-mine-wrapper .s-all-blank").show();X()}}function O(a){a.on("onSelectSwap",function(d){switch(d.type){case"added":var e=d.dragItem.attr("data-id");G.add("card",null,{id:e});H.fire("manageOpt",{opType:"manageadd",opVal:e});case"switch":var b=a.selected.drags;var c=a.selected.cache;var f=[];F.each(c,function(g){f.push(b.eq(g).attr("data-id"))});G.set("sort",null,{ids:f});break;case"remove":var e=d.dragItem.attr("data-id");G.del("card",null,{id:e});H.fire("manageOpt",{opType:"managedel",opVal:e});break}if(d.type==="switch"){H.fire("manageOpt",{opType:"managesort"})}L()})}function L(){if(!I.showed){I.shouldReflow=true;A()}}function Q(){R.removeClass("s-mine-split");if($.isIE==6){$(".sui-dialog-mask-nav-pannel").height($("body").height())}}J.init=M});F.call("mantpl:mine/presenter","init");